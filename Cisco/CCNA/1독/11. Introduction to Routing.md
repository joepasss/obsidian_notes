
In this chapter you are introduced to routing and the routing process. you will learn about the steps a router takes to select a route to a destination, including the important concept of *administrative distance*, a feature that routers use to rank and select the best route to take

You will also learn how to add a static route to the routing table and the purpose of dynamic routing protocols. You need to know about Open Shortest Path First (OSPF) only as one of several routing protocols; you should also familiar with the fact that other routing protocols exist, and you need to know the administrative distance for each of those.

## Understanding Routing

*Routing* is the process of sending data from one network to another along a chosen path. After we have divided a network into segments, it is up to the routers to move the data from one network segment to another

![[Pasted image 20250806151326.png]]

The router is responsible for routing information to the destination network, and it does this by using information stored in a *routing table*.
A routing table is a list of destination networks that resides in memory on the router; the router uses this information to identify where to send data to reach a destination. If a destination is not included in the routing table, the router will not be able to send the information to the destination.

Computer A is trying to send data off the network by first sending it to router A. Router A looks in its routing table to see whether the destination of 192.168.4.0 is listed, the router dose not know how to reach that destination, so it returns an error.
Router A includes the 192.168.3.0 network destination in its routing table. Therefore, if any systems on the 192.168.1.0 network send data to the 192.168.3.0 network, the router will send the information to the next *hop value* for that entry (shown as the "Gateway" column on the table). The hop value determines where the router needs to send the data to reach a particular destination.
In this case, it will send the data to the 192.168.2.2 hop value, and it will get to 192.168.2.2 by sending the data out the interface of 192.168.2.1 on Router A, as shown in the "Interface" column.
This column is important, because it lets the router know how a gateway can be reached from Router A.

### Routing Concepts

* **Loopback interface**
	* Routers have network interface card installed that provide network connections so that data can be sent (routed) from one network to another.
	* The router can also include a loopback interface, which is a virtual network interface card configured on the router.
	* You might configure a loopback interface for testing purposes or because a router feature may require the use of a loopback interface, for example, the routing protocol OSPF uses the IP address of the loopback interface as its router ID.
	* To control the router ID, you can configure a loopback interface and then assign an IP address to it.

* **Routing loops**
	* A routing loop occurs when two routers send a packet back and forth because each believes the packet belongs to the other router's network (because of the destination IP of the packet and the route on the router).
	* Routers use the Time-To-Live (TTL) field as a method to prevent infinite routing loops by decreasing the TTL every time a packet reaches a router. Once TTL reaches 0, the packet is removed from the network.

* **Routing tables**
	* The routing table is a list of destinations the router is aware of (destinations stored in the router's memory).
	* It indicates the route by which data should travel in order to reach a destination.
	* The router compares the destination IP address of the packet against the destination networks in its routing table. If there is a match, the router sends the packet to the IP address specified with that entry in the routing table.
	* If the destination network is not included in the routing table, the router sends an error message.

* **Static vs. dynamic routes**
	* Routes are either manually added to a routing table by the network administrator (static routes), or they are automatically learned from other routers (dynamic routes) using a routing protocol.

* **PDU**
	* A *protocol data unit* is a single unit of data communication being delivered and typically contains control information such as addressing information or data from an application.
	* The PDU for layer 1 is know as a *bit*, the PDU for layer 2 is a *frame*, the PDU for layer 3 is a *packet*, and the PDU for layer 4 is a *segment*

* **MTU**
	* The *maximum transmission unit* is the maximum size of a packet on the network.
	* With Ethernet networks, the MTU is typically 1514 bytes.

### Interface Configuration

Routers are used to connect networks and route data between these networks. A router connects to different networks via network cards, which are *interfaces* built into the router. Each interface is assigned an IP address and is connected to a network.

#### Configuring an Ethernet Interface

To assign an IP address to the Ethernet interface on Router A:
```
ROUTERA> enable
ROUTERA# configure terminal
ROUTERA (config)# interface fastethernet0/0
ROUTERA (config-if)# ip address 192.168.1.1 255.255.255.0
ROUTERA (config-if)# no shutdown
```

1. `enable`
	* used to move from user EXEC mode of the router to privileged EXEC mode.
	* In user EXEC mode, you are unable to make changes; privileged EXEC mode is required to make changes.

2. `configure terminal`
	* To change to settings of the Ethernet interface, you start at the interface prompt, which is in Global configuration mode, where most changes are made.
	* To move to Global Configuration mode, type `configure terminal`

3. `interface fastethernet0/0`
	* to move to the interface prompt, type `interface fastethernet0/0`

4. `ip address 192.168.1.1 255.255.255.0`
	* Once at the Ethernet interface prompt, you assign IP address using the `ip address` command.

5. `no shutdown`
	* enables the interface.
	* You can also disable the interface at any time using the `shutdown` command.

#### Configuring a Serial Interface

To assign the IP address to the Serial 0 port on ROUTERA:

```
ROUTERA> enable
ROUTERA# configure terminal
ROUTERA(config)# interface serial0
ROUTERA(config-if)# ip address 192.168.2.1 255.255.255.0
ROUTERA(config-if)# encapsulation hdlc
ROUTERA(config-if)# no shutdown
```

that the commands are basically the same as those used to configure the Ethernet interface. After you assign the IP address with the `ip address` command, you then set the encapsulation protocol for the serial link.
Popular encapsulation protocols over a serial link are *High-level Data Link Control (HDLC)* and *Point-to-Point* Protocol (PPP).
You need to ensure that you are using the same protocol that is used on the other end of the serial link.

#### Configuring the Bandwidth Parameter

Each interface has a *bandwidth* value assigned to it. A bandwidth value is used by certain routing protocols, such as OSPF and Enhanced Interior Gateway Routing Protocol (EIGRP), when making routing decisions.

For LAN-based interfaces, the speed of the interface becomes the bandwidth value, where the bandwidth is measured in kilobits per seconds (Kbps). However, for serial interfaces, the bandwidth defaults to 1554 Kbps, or the speed of a T1 link.
To change the bandwidth value for an interface, use the `bandwidth` command:

```
Router(config)# interface serial [slot#/port#]
Rotuer(config-if)# bandwidth rate_in_Kbps
```

### Viewing the Routing Table

Once you have assigned the IP addresses to each interface, you will need to ensure that routing is enabled on the router by typing the following commands:

```
ROUTERA> enable
ROUTERA# configure terminal
ROUTERA(config)# ip routing
```

> The `ip routing` command enables routing. To disable routing, you would type `no ip routing`

Once routing has been enabled, the router will automatically add a route for each of the networks it is directly connected to. To view the routing table and verify that the routes are added, use the following:
```
ROUTERA> show ip route
```

### Configuring Static Routing

When administering a Cisco router, you will need to add any required routes that do not already exist in the routing table.

**adds the static route to the 192.168.3.0 network**
```
ROUTERA> enable
ROUTERA# configure terminal
ROUTERA(config)# ip route 192.168.3.0 255.255.255.0 192.168.2.2
```

192.168.3.0 is the address of the destination network you are adding, and its subnet mast, 192.168.2.2 is the *next hop*--the address to which Router A will send data to reach the 192.168.3.0 network.

> `ip route` command is used to add a static route on a Cisco router
> `show ip route` command is used to display the router's routing table.

If you view the routing table by using `show ip route` command, you will notice that certain routes in the routing table are included because the router is connected to that network, as indicated with a letter C. the new routing table with the static route added, indicated with a letter S

#### Deleting a Static Route on a Cisco Router

```
ROTUERA> enable
ROTUERA# configure terminal
ROUTERA(config)# no ip route 192.168.3.0 255.255.255.0
```

#### Components of the Routing Table

![[Pasted image 20250813070842.png]]

* **Routing Code**
	* The routing code, or routing protocol code
	* indicates how knowledge of the route occurred
	* a locally connected route, a static route, or a route learned through a routing protocol such as RIP (R) or OSPF(O)
* **Prefix**
	* The network prefix
	* indicates the number of bits that make up the network ID
* **Destination/network mask**
	* This identifies the network ID in the destination network.
* **next hop**
	* This identifies where data is to be sent in order to reach that particular network destination.
* **Administrative distance**
	* This identifies how the route was learned (directly connected, through RIP, through OSPF, or a static route)
	* Each type of route has a different administrative distance, which indicates how trustworthy the knowledge of the route is.
	* The lower the administrative distance number, the more trustworthy the information is.
* **Metric**
	* When multiple routes are available to the same destination, with the same administrative distance, the router will chose a route based on a *metric*
	* The metric value indicates which routes are more efficient than others.
* **Gateway of last resort (GWLR)**
	* The GWLR references an IP address where the router is to send all traffic for which it does not have a route.
* **Outbound interface**
	* The outbound interface is the local interface on the router that the router sends the data out in order to reach the destination

### Exercise 11-1: Configuring Cisco Routers

**Configure IP addresses on the interface of two Cisco routers**

![[Pasted image 20250813073252.png]]

1. VAN-R1

```
VAN-R1> enable
VAN-R1# config term
VAN-R1(config)# interface g0/0
VAN-R1(config-if)# ip address 12.0.0.1 255.0.0.0
VAN-R1(config-if)# no shutdown

VAN-R1(config-if)# exit

VAN-R1(config)# interface s0/3/0
VAN-R1(config-if)# ip address 13.0.0.1 255.0.0.0
VAN-R1(config-if)# encapsulation hdlc
VAN-R1(config-if)# clock rate 64000
VAN-R1(config-if)# no shutdown

### verify
VAN-R1# show ip route
```

2. LA-R1

```
LA-R1> enable
LA-R1# config term
LA-R1(config)# interface g0/0
LA-R1(config-if)# ip address 14.0.0.1 255.0.0.0
LA-R1(config-if)# no shutdown

LA-R1(config-if)# exit

LA-R1(config)# interface s0/3/0
LA-R1(config-if)# ip address 13.0.0.2 255.0.0.0
LA-R1(config-if)# encapsulation hdlc
LA-R1(config-if)# no shutdown

### verify
LA-R1# show ip route
```

---

## Understanding Dynamic Routing

Dynamic routing protocols are used to share routes between routers so that administrators do not need to add routers manually.

Managing the entries in routing tables on a large internetwork could be a time-consuming task. To help administrators with this, *dynamic routing* protocols are enabled. These protocols enable the routers to share information contained within their routing tables with one another. As a result, routes that are known by one router will be shared with the other routers, thus saving the administrator from having to add all the routes manually

Convergence, also known as steady state, occurs when all routing tables (routes) have been shared with all other routes and all routers have updated their routing tables with that new information.

**Two major categories of routing protocols**
* **Interior gateway protocols (IGPs)
	* An IGP shares routing table information with other routers located inside your network, known as an *autonomous system (AS)*.
	* Routing Information Protocol(RIP)
	* Enhanced Interior Gateway Routing Protocol (EIGRP)
* **Exterior gateway protocols (EGPs)**
	* An EGP that is loaded on a router will share routing table information to other routers outside your network.
	* Border Gateway Protocol (BGP)

> Convergence, also known as steady state, occurs when all routing tables (routes) have been shared with all other routers and all routers have updated their routing tables with that new information.
### Routing Metrics

A routing protocol decides on the best route to a network by analyzing the routing table and choosing the route with the lowest metric value.

Determining the "best route" metric value can involve different things, depending on the routing protocol.

**common values used to measure the metric value of a route**

* **Hop count**
	* Some routing protocols use hop count as a metric value, which means that the best route is determined based on how many hops away the network is.
	* Every router that data must pass through is considered a hop, and the lowest hop count is the best route to take with this metric.
* **MTU or bandwidth**
	* Some routing protocols determine the best route to take based on the MTU or bandwidth of the link.
	* Routes with more bandwidth would be preferred over lower bandwidth routes.
* **Costs**
	* Some routing protocols choose the best route based on the lowest cost.
	* A cost value is considered a preference value on the link, and the link with the lowest cost value will be selected as the route to the destination.
	* For example, a link to a destination with a cost of three is chosen over a different link to the same destination with a cost value of five
* **Latency**
	* Some routing protocols use the latency of the link as the metric value.
	* Latency refers to how long it takes a packet to travel from one place to another. Lower latency routes are preferred over higher latency routes with this metric criterion
* **Administrative distance**
	* The administrative distance is the "trustworthiness" of the route that is in the routing table.
	* Each different method of adding a route to a routing table has an administrative distance value--if the router was to learn about a route two or more different ways, then the route with the lower administrative distance is the one the router would use.
	* For example, a static route has an administrative distance of 0, while a route learned via RIP has an administrative distance of 120. In this case, if the routes were for the same destination network, the router would use the static route, because it is considered to be more trustworthy.

It is important to note that some routing protocols combine some of these different metric values to determine the best route possible.
When discussing the different routing protocols, it is important to note that there are two major classes: *distance vector* and *link state*. Each routing protocols is either a distance vector protocol or a link state protocol.

### Configuring a Routing Protocol

you need to perform two basic steps when setting up IP routing on your router:

* Enable the routing protocol
* Assign IP address to your router's interfaces

That the order of these tasks is not important.

#### The `router` command

Enabling an IP routing protocol is a two-step process.

you must go into router subconfiguration mode. This mode determines the routing protocol that you'll be running. Within this mode, you'll configure the characteristics of the routing protocol.

```
Router(config)# router name_of_the_IP_routing_protocol
Router(config-rotuer)#
```

The `router` command is used to access the routing protocol that you want to configure; it doesn't enable it. If you are not sure of the name of the routing protocol that you want to enable, use the context-sensitive help feature:

```
Router(config)# router ?
```

#### The `network` command

Once you have enabled the routing protocol, you need to specify what interfaces are to participate in the routing process. By default, no interfaces participate in the routing process.

To specify which interface will participate, use the `network` mode command

```
Router(config-router)# network IP_network_#
```

As soon as you enter a network number, the routing process becomes active.

### Distance Vector Protocols

*Distance vector* routing protocols measure the best route to use based on the lowest hop count.

The hop count is increased by 1 for every router between the source and the destination. With distance vector routing protocols, the route with the lowest hop count is typically selected as the destination path for the data.

> Distance vector protocols include RIP and IGRP

#### RIP/RIPv2

RIP is a distance vector protocol that is responsible for sharing its routing table information with neighboring routers by broadcasting the information over User Datagram Protocol (UDP) every 30 seconds.
This broadcasting, or *advertising*, of routing table information with neighboring routers exempts the network administrator from having to add the routes manually.

RIP is an industry-standard routing protocol, which means that it is supported by many different vendors, so you could use it as a routing protocol to share routing table information between routers from different manufacturers. RIP will choose the route with the lowest hop count, but if two different routes have the same hop count, RIP will load-balance the traffic over those tow routes. Be aware that RIP is limited to 15 hops, so it is used only on small networks.

RIPv1 works only with classful addresses because it doesn't send subnet mask information with the routing table. RIPv2 is an update to RIPv1 and does support classless addressing and variable-length subnet masks, because it sends the subnet mask information with the routing table.

Assume you are the administrator for Router A. Router A will have routes to the 192.168.1.0 and 192.168.2.0 networks by default. If you wanted to configure RIP on Router A to advertise knowledge of those two networks, you would type the following commands on Router A:
```
ROUTERA> enable
ROUTERA# configure terminal
ROUTERA(config)# router rip
ROUTERA(config-router)# version 2
ROUTERA(config-router)# network 192.168.1.0
ROUTERA(config-router)# network 192.168.2.0
```

Once RIP or any other routing protocol, has been enabled on both Router A and Router B, the two routers will share knowledge of any networks they know about.

Router A receives knowledge of the 192.168.3.0 network and builds the new network into its routing table; this is called *convergence*.

#### IGRP

IGRP is classful routing protocol that was built by Cisco, so you will use it only on networks where you have only Cisco routers. IGRP was designed to improve on RIP limitations; it has a maximum hop count of 255 and uses the concepts of an *autonomous system (AS)*.
An autonomous system is a grouping of routers that share routing table information. Routers using IGRP will share the routes only with other routers in the AS. Another improvement is that the full routing table is advertised every 90 seconds instead 30 seconds, as is the case with RIP.

To enable IGRP:
```
ROUTERA> enable
ROUTERA# configure terminal
ROUTERA(config)# router igrp 10
ROUTERA(config-router)# network 192.168.1.0
ROUTERA(config-router)# network 192.168.2.0
```

enabling IGRP on a Cisco router is similar to enabling RIP. The difference, however, is that when you enable IGRP, you specify the AS number for the router. In this case, 10 for the AS number, so any other router with an AS number of 10 will receive routing information for the 192.168.1.0 and 192.168.2.0 networks.

### Link State Protocols

Link state routing protocols are little more advanced than distance vector routing protocols in the sense that a link state routing protocol knows about the entire network topology.

A link state protocol is responsible for monitoring the state of the link between the routers. This link state information is then used to determine the optimal route to a destination network. Although protocols such as RIP have knowledge of neighboring routers, link state protocols have knowledge of the entire network topology and multicast the routing table information to the entire network.

One of the benefits of the link state routing protocols is that if a link is down, that information is stored in the routing table and that pathway will not be used. Because a distance vector routing protocol does not store link state information, it is possible that it will not know that a link is unavailable for some time and could still send traffic through that pathway.

#### OSPF

*Open Shortest Path First(OSPF)* is an example of a link state protocol. OSPF is an industry-standard protocol, which means that it is available to routers built by different manufacturers, and you can use it to share routing information between dissimilar routes.

Like IGRP, OSPF uses autonomous systems, but it also has the capability of dividing the AS into logical groups, called *areas*. OSPF supports Variable Length Subnet Masks (VLSMs) and has an unlimited hop count.

#### IS-IS

The *Intermediate System-Intermediate System (IS-IS)* routing protocol competes with OSPF by being a link state routing protocol for inside the network (interior gateway). IS-IS was developed by Digital Equipment Corporation (DEC) and has become an industry-standard protocol, although it's not as popular as OSPF. Like OSPF, IS-IS uses a link state algorithm to maintain status information on all the links and routes on the network so that each router running the IS-IS protocol will have knowledge of the entire network topology.

### Hybrid Protocols

Hybrid routing protocols combine the features of distance vector and link state.
Cisco uses two hybrid protocols: EIGRP and BGP

#### EIGRP

As a popular hybrid routing protocol that was built by Cisco, EIGRP improves upon IGRP by being a *classless* routing protocol that supports VLSM and both IPv4 and IPv6.
EIGRP also has maximum hop count of 255 hops.

To configure EIGRP:
```
ROUTERA> enable
ROUTERA# configure terminal
ROUTERA(config)# router eigrp 10
ROUTERA(config-router)# network 192.168.1.0
ROUTERA(config-router)# network 192.168.2.0
```

#### BGP

BGP is an EGP that is responsible for sharing routing table information with routers *outside* your autonomous system. The protocols discussed previously (RIP, EIGRP, and OSPF) are known as interior gateway protocols, which are responsible for sharing routing table within your autonomous system (or network).

BGP is designed to send changes made to the routing table when they occur, versus at a regular interval as RIP does. BGP sends only the change, while other routing protocols send the entire table. BGP is also a classless routing protocol that supports Classless Interdomain Routing (CIDR).

> BGP is a newer version of the EGP

---

## The Routing Process

Several different types of routes can exist on a Cisco router. Determining the best route involves consideration of a number of criteria.

### Types of Routes

A number of different types of routes can exist in the routing table of a Cisco router.

#### Network Route

A network route points to the network ID of a network or subnet. For example, in order for the router to send data to a server with an IP address of 14.0.0.10, the router would look in its routing table for a route to the 14.0.0.0/8 network. A network route may appear in the routing table because the network is connected to the router---a connected route--or because the administrator added it manually--a static route.

#### Connected Route

To determine a *connected* or *directly connected* route, a router will look at its active interfaces, examine the address configured on the interfaces and determine the corresponding network numbers, and populate the routing table with this information

#### Static Route

A *static route* is a manually configured route on your router. Static routes are typically used in smaller networks and when few networks or subnets exist, or with WAN links that have little available bandwidth.
With a network that has hundreds of routes, static routes are not scaleable, since you would have to configure each route and any redundant paths for each route on each router.

To configure a static route for IP:

```
Router(config)# ip route dest_network_# [subnet_mask] ip_addr_of_next_hop_neighbor [administrative_distance] [permanent]

or

Router(config)# ip route dest_network_# [subnet_mask] exit_interface_name [administrative_distance] [permanent]
```

The first parameter that you must specify is the destination network number. If you omit the subnet mask for the network number, it defaults to the Class A (255.0.0.0), B (255.255.0.0), or C (255.255.255.0) default subnet mask, depending on the network number of the destination

After the subnet mask parameter, you can specify how to reach the destination network in one of two ways: you can tell the router the next hop neighbor's IP address, or indicate the interface the router should exit to reach the destination network.
Use the former method for a multi-access link. Use the later method for a point-to-point link. In this instance you must specify the *name* of the interface on the router, like so: **serial0**

Optionally, you can change the administrative distance of a static route. If you omit this value, it will use one of two default values, depending on the configuration of the previous parameter: If you specified the next-hop neighbors IP address, the administrative distance defaults to 1. If you specified the interface on the router it should use to reach the destination the router treats the route as a connected route and assigns it an administrative distance of 0.

Note that you can create multiple static routes to the *same* destination.
For instance, you may have primary and backup paths to the destination. For the primary path, you could use the default administrative distance value. For the backup path, you could use a number higher than this, such as 2. Once you have configured a backup path, the router will use the primary path, and if the interface on the router fails for the primary path, the router will use the backup route.

The **permanent** parameter will keep the static route in the routing table even when interface the router uses for the static route fails.
If you omit this parameter, and the interface used by the static route fails, the router will remove this route from its routing table and attempt to find an alternative path to place in the routing table. You may want to use the **permanent** parameter if you never want packets to use another path to a destination, perhaps because of security reasons.

#### Default Route

One special type of static route is a *default route*, commonly called the *gateway of last resort (GWLR)*. If the specified destination is not listed in the routing table, the default route can be used to route the packet.
A default route has an IP address 0.0.0.0 and a subnet mask of 0.0.0.0, often represented as 0.0.0.0/0.
Default routes are commonly used in small networks on a perimeter router pointing to the directly connected ISP router.

To set up a default route, use the following syntax for a static route:
```
Router(config)# ip route 0.0.0.0 0.0.0.0 IP_addr_of_next_hop_neighbor [administrative_distance] [permanent]

or

Router(config)# ip route 0.0.0.0 0.0.0.0 exit_interface_name [administrative_distance] [permanent]
```

#### Default Network Configuration

An alternative way to configure a default route is to define a default network. When you configure the `ip default-network` command, the router considers routes to that network for installation as the GWLR on the router.
This command is used when no other router exists in the routing table (connected, static, or dynamic).

Use the `show ip route` command to verify that the default route has been set:
```
Router# show ip route

....

Gateway of last resort is not set

....
```

"`Gateway of last resort is not set`" This is the default configuration. To define GWLR, use this command:

```
Router(config)# ip default-network network_number_to_use
```

The network number you define is the network the router should access as a last resort. Note that your routing table will need an entry indicating how to reach this default network, such as a next-hop address. This is typically done via a static route.

> Use an address and subnet mask of 0.0.0.0 0.0.0.0 when creating a default route when no other specific route is available to a destination within the routing table. The GWLR is defined with the `ip default-network` command

#### Host Route

A host route references the full IP address of a computer on the network. You may see an entry that appears in the routing table with a /32, meaning that all bits are network bits--you should treat the entire address as a network ID.

#### Floating Static Route

A floating static route is a backup route to a destination to which you have a primary route. The floating static route will not appear in the routing table until the primary route fails, and then the floating static route will appear.
You configure a floating static route by creating a static route with an administrative distance that is higher than the route you are trying to back up (whether it be another static route or a route learned via a dynamic routing protocol).

adds a floating static route by setting the administrative distance to 10

```
VAN-R1# config term
VAN-R1(config)# ip route 14.0.0.0 255.0.0.0 12.0.0.100 10
```

### Selecting a Route

When the Cisco device selects a route to use for a particular destination, it uses a number of criteria: it first checks for a longest matching network prefix, then it selects a route based on the administrative distance, and finally it may look at the metric value if the network prefix and administrative distance are equal on multiple routes.

#### Longest Match

The first routing criteria used by a router is the longest matching previx.
It essentially chooses the route to a destination network with the longest network or subnet ID. This ensures that if the network is subnetted, the more specific route is being used.

#### Administrative Distance

Each router needs to choose a *best* path to a destination. This process can become somewhat complicated if the router is receiving routing update information for a single network from multiple sources, such as connected, static, and IGP routing protocols, and must choose *one* of these sources as the best place this choice in the router's routing table.
After choosing routes based on network ID matching, the router looks at the administrative distance to determine a trustworthiness for the knowledge of a route (the lower the administrative distance, the more trustworthy the route.)

For example, suppose a connected route has an administrative distance of 0, while a static route has an administrative distance of 1. If you added a static route for a network ID that already existed because the router was connected to that network, the router would use the connected route over your static route. (From a trust point of view, you could have a typo in your static route so the router trusts what it is connected to over what the administrator typed.)

As another example, the RIP has an administrative distance of 120, so if RIP is sharing a network ID, and you have configured a static route to the same destination, the router will choose your static route over the route learned through RIP, because static routes a lower administrative distance value(1).

**default administrative distance**

| distance | Route Type                                                       |
| -------- | ---------------------------------------------------------------- |
| 0        | Connected interface route                                        |
| 1        | static route                                                     |
| 90       | Internal EIGRP route (within the same AS)                        |
| 110      | OSPF route                                                       |
| 120      | RIPv1 and v2 route                                               |
| 170      | External EIGRP (from another AS)                                 |
| 255      | Unknown route (considered an invalid route and will not be used) |

#### Routing Protocol Metric

The route selection process so far chooses a route based on the network destination ID first, and then the administrative distance.
But what if there are multiple routes with the same administrative distance--let's say two routes being shared to your router via OSPF? If a situation arises where two paths to the destination network exist, and the *same* routing protocol is being used to share that knowledge to your router, the router will use a measurement called a *metric* to determine which path is the best path to place in the routing table

**common metrics**

| Metric      | Routing Protocols | DESC                                                     |
| ----------- | ----------------- | -------------------------------------------------------- |
| Bandwidth   | EIGRP             | The capacity of the links in Kbps                        |
| Cost        | OSPF              | Measurement in the inverse of the bandwidth of the links |
| Delay       | EIGRP             | Time it takes to reach the destination                   |
| Hop Count   | RIP               | How many layer 3 hops away from the destination          |
| Load        | EIGRP             | The path with the least utilization                      |
| MTU         | EIGRP             | The path that supports the largest frame sizes           |
| Reliability | EIGRP             | The path with the least amount of errors or downtime     |

some routing protocols use only a single metric. For instance, RIP uses hop count as a metric and OSPF uses cost. 

Other routing protocols use multiple metric values to choose a best path to a destination. For instance, EIGRP can use bandwidth, delay, reliability, load, and MTU when choosing a best path a destination.

---

## Routing Troubleshooting Commands

Once you have configured your routing protocol, you can use a variety of commands to verify and troubleshoot the routing configuration and operation.

* **`clear ip route`**
* **`show ip protocols`**
* **`show ip route`**
* **`debug ip rip`**

### The clear ip route Command

The `clear ip route *` command is a privileged EXEC mode command. This command clears and rebuilds the IP routing table.

Any time you make a change to a routing protocol, you should clear and rebuild the routing table with this command. You can replace the asterisk with a specific network number; if you choose to do so, this will clear only the specified route from the routing table.

Note the the `clear` command clears only routes learned from a routing protocol (dynamic routes); static and directly connected routes cannot be cleared from the routing table using the `clear` command.
Static routes must be cleared manually using the `no ip route` command, and directly connected routes are persistent and cannot be removed from the routing table unless the interface they are associated with is not operational.

### The show ip protocols Command

The `show ip protocols` command displays all the IP routing protocols, including RIP, which you have configured and are running on your router.

```
Router# show ip protocols
Routing Protocol is "rip"
  sending updates every 30 seconds, next due in 5 seconds
  Invalid after 180 seconds, hold down 180, flushed after 240
  Outgoing update filter list for all interfaces is not set
  Incoming update filter list for all interfaces is not set
  Redistributing: rip
  Default version control: send version 2, receive version 2
    Interface    Send  Recv  Triggered RIP key-chain
    Ethernet0    2     2
    Ehternet1    2     2
    Automatic network summarization is in effect
    Maximum path: 4    Routing for networks:
      192.168.1.0
      192.168.2.0    Routing Information Sources:
      Gateway        Distance        Last Update
      192.168.2.2         120        00:00:22
      192.168.3.2         120        00:03:30
    Distance: (default is 120)
```

RIPv2 is running on the router. The routing table update interval is 30 seconds, with the next update being sent in 5 seconds. You can see that two interfaces are participating: Ethernet0 and Ethernet1.
RIPv2 is being used to generate and receive updates on these two interfaces.
You can see the two networks specified with the `network` commands: 192.168.1.0 and 192.168.2.0 In this example, this router received an update 22 seconds ago from a neighboring router: 192.168.2.2.
For the second gateway, 192.168.3.2, the router hasn't seen an update from it in 210 seconds, Given that the flush timer is 240 seconds, if the local router doesn't receive an update from 192.168.3.2 within 30 seconds, 192.168.3.2 and its associated routes are removed from the local router (flushed). And last, the default administrative distance of RIP is 120.

### The show ip route Command

To view the routing table, use the `show ip route` command.

```
Router# show ip route
Codes: C - connected, S - static, I - IGRP, R - RIP
       M - Mobile, B - BGP, D - EIGRP, EX - EIGRP external
       O - OSPF, IA - OSPF inter area, N1 - OSPF NSSA
       external type 1, N2 - OSPF NSSA external type 2,
       E1 - OSPF external type 1, E2 - OSPF external type 2,
       E - EGP, i - IS-IS, L1 - IS-IS level-1,
       L2 - IS-IS level-2, * - candidate default,
       U - per-user static route, o - ODR,
       T - traffic engineered route

Gateway of last resort is not set
	172.16.0.0/24 is subnetted, 2 subnets
C      172.16.1.0 is directly connected, Ethernet 0
R      172.16.2.0 [120/1] via 172.16.1.2, 00:00:21, Ethernet0
    192.168.1.0/24 is subnetted, 2 subnets
C      192.168.1.0 is directly connected, Serial0
R   192.168.2.0/24 [120/2] via 192.168.1.2, 00:00:02, Serial2
```

In this example, you can see that two types of routes are in the routing table: R is for RIP and C is for directly connected route.

For the RIP entries, you can see two numbers in brackets: the administrative distance of the route and the metric.
For instance, 172.16.2.0 has an administrative distance of 120 and hop count is 1 (the metric in this example, `172.16.2.0 [120/1]`).

Following this information is the neighboring RIP router that advertised the route (172.16.2.0), how long ago an update for this route was received from the neighbor (21 seconds), and on which interface this update was learned (Ethernet0).

### The debug ip *`protocol`* Command

Remember that `show` commands show a static display of what the router knows, and they sometimes don't display enough information concerning a specific issue or problem.
For instance, you might be looking at your routing table with the `show ip route` command won't tell you why a route is or isn't in the routing table. However, you can resort to debug commands to assist you in your troubleshooting.

For more detailed information about the events and packets being sent or received with a routing protocol that can be used to troubleshoot routing protocol problems, you can use the `debug ip <protocol>` command, where `<protocol>` can be RIP, EIGRP, or OSPF

```
Router# debug ip rip
RIP protocol debugging is on
Router#
00:12:16: RIP: received v1 update from 192.168.1.2 on Serial0
00:12:16:      192.168.2.0 in 1 hops
00:12:25: RIP: sending v1 update to 255.255.255.255 via Ethernet0
172.16.1.1)
00:12:26:      network 192.168.1.0, metric 0
00:12:26:      network 192.168.2.0, metric 1
```

This command displays the routing updates sent and received on the router's interfaces.
In the code example, the router received a V1 update from 192.168.1.2 on Serial0. This update contained one network, 192.168.1.2, indicating that this network is reacheable from this and the advertising routers.
After this update, you can see that your router generated a RIP update (local broadcast-255.255.255.255) on its Ethernet0 interface. This update contains two networks: 192.168.1.0 and 192.168.2.0. Also notice the metrics associated with these routes: 192.168.1.0 is connected to this router, while 192.168.2.0 is one hop away.
When the neighboring router connected to Ethernet0 received this update, it will increment the hop count by 1 for each route in the update.

---

## Router-on-a-Stick

that VLANs can be used to configure communication boundaries on the network. To enable communication between VLANs, you can either connect a router interface to each VLAN or use the router-on-stick method.

Typically, we think of routing as traffic entering one physical interface and leaving another physical interface. however, trunks can be used to support multiple VLANs, where each VLAN has a unique layer 3 network or subnet number. Certain router models and interface combinations, such as the 1800 series, support trunk connections.
A *router-on-a-stick* is a router that has a single trunk connection to a switch and routes between the VLANs on this trunk connection. You could easily do this without a trunk (access-link connection), but each VLAN would require a separate access-link (physical) interface on the router, and this would increase the price of the router solution.

For instance, if you had five VLANs and your router didn't support trunking, you would need five physical LAN interfaces on your router, and on your switch, to route between the five VLANs.
However, with a trunk connection, you can route between all five VLANs on a *single* interface.
Because of cost and scalability, most administrators prefer using a router-on-a-stick approach to solve their routing problems in switched networks.

> A router-on-a-stick is a router that has a single trunk connection to a switch and routes between multiple VLANs on this trunk. Subinterfaces are used on the router to designate the VLAN with which they are associated. Each VLAN needs a different IP subnet configuration.

### Subinterface Configuration

To set up a router-on-a-stick, you need to break up your router's physical interface into multiple logical interfaces, or *subinterfaces*.
Cisco supports up to 1000 interfaces on a router, including both physical and logical interfaces. Once you create a subinterface, a router will treat this logical interface just like a physical interface: you can assign layer 3 addressing to it, enable it, disable it, and do many other thinks.

To create subinterface:
```
Rotuer(config)# interface type port_#.subinterface_#
Router(config-subif)#
```

After entering the physical interface type and port identifier, follow this with a dot (.) and a subinterface number. The subinterface number can range from 0 to 4,294,967,295. The number that you use for the subinterface number is only for reference purposes within IOS, and the only requirement is that when creating subinterface, you use a unique subinterface number.

At the end of the statement, you must specify the type of connection if the interface is of type serial; otherwise, you can omit it. The **`point`** parameter is used for point-to-point serial connections, and **`multipoint`** is used for multipoint connections (many devices connected to the interface).
The *multipoint* parameter is used for connections that have more than one device connected to them (physically or logically). For a router-on-a-stick configuration, you can omit the connection type, since the default is **multipoint** for LAN interfaces.

### Interface Encapsulation

Once you create a subinterface, you'll notice that your CLI prompt has changed and that you are now in subinterface configuration mode. If you are routing between VLANs, you'll need an interface that supports trunking. Some things are configured on the major interface, an some things are configured on the subinterface.
Configurations such as duplexing and speed are done on the major (or physical) interface. Most other tasks are done on the subinterface (the logical interface), including to which VLAN the subinterface belongs and its IP addressing information.

When setting up your subinterface for a router-on-stick, you must configure the type of trunking (interSwitch Link (ISL) or 802.1Q) and the VLAN with witch the subinterface is associated

```
Router(config)# interface type port_#.subinterface_#
Router(config-subif)# encapsulation isl|dot1q VLAN_#
```

Use the `encapsulation` command to specify the trunk type and the VLAN associated with the subinterface. The VLAN number you specify here *must* correspond to the correct VLAN number in your switched network.
You must also set up a trunk connection on the switch for the port to which the router is connected. Once you do this, the switch will send tagged frames to the router, and the router, using your encapsulation, will understand how to read the tags. The router will be able to see from witch VLAN the frame came and match it up with the appropriate subinterface that will process it.

> The router and switch must be using the same VLAN encapsulation type: 802.1Q or ISL

### Router-on-a-Stick Example Configuration

![[Pasted image 20250819104932.png]]

Assume that the Fast Ethernet interface on the router is the first interface in the first slot and the switch is using 802.1Q trunking on the connected interface.

```
Router(config)# interface FastEthernet0/0
Router(config-if)# duplex full
Router(config-if)# no shutdown
Router(config-if)# exit

Router(config)# interface FastEthernet0/0.1
Router(config-subif)# encapsulation dot1q 10
Router(config-subif)# ip address 172.16.1.1 255.255.255.0
Router(config-subif)# exit

Router(config)# interface FastEthernet0/0.2
Router(config-subif)# encapsulation dot1q 20
Router(config-subif)# ip address 172.16.2.0 255.255.255.0
Router(config-subif)# exit
```

Notice in this example that the subinterface numbers in the `interface` command (1 and 2) do not match the VLAN numbers in the `encapsulation` command (10 and 20); remember that the subinterface numbers are used by IOS only to reference the particular subinterface and do not have to match any configuration on the subinterface.

> If you are configuring static routes and want to route traffic out of a particular subinterface, specify the major interface along with the subinterface number, such as fastethernet0/0.2

---

## Router High Availability

With layer 3 redundancy, you're normally dealing with having multiple paths to a destination and using a dynamic routing protocol to find the best or an alternative path.
This section, however, deals with another type of layer 3 redundancy: default gateways and server load balancing. These are issues typically found at the access and distribution layers.

### Problems of Traditional Default Gateway Redundancy Solutions

You can easily place two routing devices at the distribution layer of each switch block to provide redundancy for end stations to leave their VLAN.
However, this may not provide a true fault-tolerant solution. This is especially true for situations in witch end stations do not support a router discovery protocol to learn which routers they can use or which routers can't be configured to use more than one default gateway address.

#### Proxy ARP Issues

Some end stations can use Proxy ARP to discover the IP address of the default gateway. In this situation, the end station dynamically acquires the IP address and MAC address of the default gateway and sends all of its inter-VLAN traffic to this routing device. To begin, the end station doesn't know how to reach the destination and generates an ARP request for the destination. Obviously, if the destination is not in the same VLAN, no one responds and the end station assumes that the destination is not reachable. However, a Cisco router can proxy this ARP by sending back its own MAC address to the end station, and the end station can then use the router to send traffic out of the subnet. From end station's perspective, it thinks it's sending traffic directly to the destination, but it's actually being relayed by the router. On Cisco IOS devices with routing enabled, Proxy ARP is enabled, by default, on the routing interfaces.

A problem arises, however, when the default gateway fails. In this situation, the end station still sends its information to the failed default gateway, where the traffic is dropped. Sometimes a client re-performs the ARP after a lengthy period of time to verify the destination's existence. However, in most implements of ARP, the end station continues to use the same failed gateway MAC address unless it is rebooted.

#### ICMP Router Discovery Protocol Issues

The Internet Control Message Protocol Router Discovery Protocol (IRDP) is not a routing protocol like OSPF or RIP; instead, it is an extension to ICMP that enables an end station to automatically discover the default gateways connected to the same VLAN. IRDP is covered in RFC 1256.
In this environment, the routing devices periodically generate special multicast packets that announce the router's existence to the clients. This time period is usually between 5 and 10 minutes. Learned information usually has a maximum lifetime of 30 minutes on the client if no more IRDP messages are received from the advertising routing device. The multicast packet includes the routing device's address and a lifetime value.

With IRDP, end stations can dynamically discover other routing devices when their primary default gateway fails. However, this may take up to 30 minutes, based on the lifetime value in the original multicast packet from the routing device. And even if you may consider using IRDP with your access layer devices, most end-station IP stacks do not support IRDP.

#### Routing Protocol Issues

To overcome these two previous problems, you may be able to run a routing protocol on the end station if the client supports this type of function. With IP, the only routing protocol that most end stations *might* support is RIP or OSPF.
In RIP or OSPF, the end station could make intelligent decisions about which layer 3 routing device to use to access other subnets. However, the issue with RIP is that its convergence is very slow it could take up to 180 seconds before an alternative routing device is chosen when the current primary routing device fails. With TCP sessions, this would cause a timeout. Because of this, as well as additional overhead that RIP creates, the solution is not very desirable for your end stations and this assumes that your end stations and other network devices support a routing protocol such as RIP.

#### User Device Issues

In most campus environments, end stations are assigned a single IP address for the default gateway (which is usually done via DHCP). In this environment, if the routing device (default gateway) were to fail, the end station would lose its capability to access other networking devices outside of its VLAN. Unfortunately, there is no redundancy in this implementation, because an end station can have only one default gateway address configured (whether it is assigned via DHCP or statically configured).

### Hot Standby Router Protocol

**HSRP** is Cisco-proprietary protocol that provides a single definition of a default gateway on the end station and provides layer 3 redundancy for overcoming the issues of IRDP, Proxy ARP, and end-station routing protocols.

Unlike the four previous solutions, HSRP is completely transparent to the end stations you do not have to perform any additional configuration on the end stations themselves. HSRP enables Cisco routing devices to monitor one another's status, which provides a very quick failover when a primary default gateway fails. This is done by establishing HSRP groups.

With HSRP, a group of routing devices represents a single virtual default gateway. This virtual default gateway has a virtual IP address and a virtual MAC address. If the primary routing device fails, another routing device in the HSRP group takes over and process the frames sent by the end stations to the virtual MAC address.

An advantage of HSRP groups is that different subnets (VLANs) can have different default gateways, thus providing load balancing. Also, within each HSRP group is a primary default gateway and the capability to use multiple routers to perform a backup function. You can have up to 256 standby groups per routing device, providing up to 256 default gateways. Routing devices can provide backup for multiple primary default gateways. Each standby group keeps track of the primary routing device that's currently forwarding traffic sent to the virtual MAC address. Note that only one routing device is actually forwarding traffic with HSRP.

Another nice feature of HSRP is that you can customize it based on the size of your network. For instance, if you have a VLAN with 1000 devices in it, you can set up two HSRP groups: one group for 500 devices and another group for the other 500 devices. You then assign routing devices to each group. For example, if you had only two routing devices, you could have the first routing device be the active routing device for group 1 but the standby for group 2, and vice versa for the second routing device.
Through this process, you can have both of your routing devices forwarding traffic while still providing redundancy if the active routing device in either group fails, the other routing device promotes itself to an active state.

#### HSRP Operation

As mentioned in the previous section, only one routing device actually forwards traffic for an HSRP group. Using a priority scheme, one routing device is elected as the forwarding router and the others perform as backups for a group.
Each routing device has a default priority of 100, which you can manipulate. The routing device with the highest priority in the group is elected as the active router, and the other routing devices are placed in standby mode. The active routing device responds to any ARP packets from end stations and replies with the virtual MAC address of the group.

Each HSRP group must have a unique virtual IP address and a virtual MAC address, which means these addresses must be unique across different groups. This MAC address is 0000.0c07.acXX. The 0000.0c is Cisco's vendor code. The 07-ac is HSPR's well-known address. The XX is the group number (in hex) for the HSRP group.
Therefore, each HSRP group must have a unique address to ensure that the MAC address is unique in a VLAN.

With HSRP, the end stations would perform an ARP with the virtual IP address, requesting the virtual MAC address of the default gateway routing device.
Not that in this setting, the end stations are completely unaware of the actual routing devices handling traffic destined for a virtual router. Even when the primary fails and the standby routing device starts handling traffic for the broadcast domain, the end stations still think they're talking to the same routing device.

#### Types of Routing Devices

Every HSRP group contains the following types of routing devices that perform certain roles:

* Virtual routing device
* Active routing device
* Standby routing device
* Other HSRP routing device

The role of the **virtual routing device** is to provide a single RP that's always available to the end stations. It is not a real RP because the IP and MAC addresses of the virtual RP is not physically assigned to any one interface on any of the routing devices in the broadcast domain.

The role of the **active and standby routing devices** is based on the priority of the routing devices in the HSRP group. The routing device with the *highest priority* is elected as the active routing device, and the one with the second highest priority is elected as standby routing device. If the priorities are the same, the IP address of the routing device is used as a tiebreaker. In this situation, the routing device with the *higher* IP address is elected for the role.

The **active routing device** is responsible for forwarding all traffic destined to the virtual routing device's MAC address, and the standby routing device keeps tabs on the active routing device by looking for HSRP multicast messages, called *HSRP hellos*.
The active routing device does not see any hellos every 3 seconds. If the standby routing device does not see a hellos for 10 seconds from the active routing device, the standby device prompts itself and begins performing the functions of the active device.
Like the active device, the standby device also announces itself every 3 seconds so that if it fails, one of the other HSRP routers in the standby group can assume the standby routing device role.

The **other routing devices** in the HSRP group, if any exist, listen for the hello multicasts form the standby and active routing devices to ensure that they are performing their respective roles.
When the active routing device fails, the view from the end stations' perspective is the same they're still forwarding their frames to the virtual MAC address. When this happens, the standby routing device starts processing the frames sent to the virtual MAC address, and one of the other HSRP routers in the group is elected to the standby role.

#### HSRP Multicast Messages

To declare which routing devices will become the active and standby routing devices, all the routing devices in the HSRP group initially send out HSRP multicast messages. These UDP messages, using port number 1985, are addressed to the all-router multicast address (224.0.0.2) with a Time-To-Live (TTL) value of 1.
A TTL of 1 ensures that any multicast routing protocol that's running will not forward the message to a different subnet.

The HSRP message contains:
* HSRP version number
* Operation code (opcode) message type:
	* Hello messages
		* used by the routing devices for the election process and by the active and standby routing devices when they have been elected
	* Resign messages
		* Used by an RP when it wants to stop performing the function of the active RP
	* Coup messages
		* Used by an RP that wants to become the active RP
* Current HSRP state
* Hello time interval of HSRP messages (default to 3 seconds)
	* how often HSRP messages are generated
* Hold-down time interval (defaults to 10 seconds)
	* the length of time that a hello message is considered valid
* Priority of the RP
	* used to elect the active and standby routing devices
* Standby group number (0-255)
* Authentication password, if configured
* Virtual IP address of the HSRP group
	* The default gateway IP address that you end stations should use

#### HSRP States

HSRP supports six different states. A routing device may go through all these states or only a few of them, depending on whether it becomes an active or standby routing device:

* Initial
* Learn
* Listen
* Speak
* Standby
* Active

When the routing devices are enabled, they start in an *initial state*. Note that they have not begun the HSRP process in an initial state only the routing devices themselves and their associated interfaces have been activated.

In a *learn state*, a routing device listens for an active routing device. The routing device initially has no knowledge of any other HSRP routers. In this state, its purpose is to discover the current active and standby routing devices and the virtual IP address for the group.

After the routing device sees a multicast from the active/standby routing device, it learns about the virtual IP address. This is called the *listen state*. In this state, the routing device is neither the active nor the standby routing device.
If there's already a standby and active routing device, the listening routing device remains in this state and does not proceed to any of the next three states.
The exception to this is if you've configured *preemption*. With preemption, a new routing device with a higher priority can usurp an existing active or standby routing device.

If the routing device enters the *speak state*, the device propagates multicast messages so that it can participate in the election process for the standby or active role. These hellos are sent out periodically so that other routing device to enter this state, it must have the virtual IP address configured on it.

Based on the routing device's priority, it becomes either a *standby* or *active* routing device.
In a *standby* state, the routing device is the next in line to assume the role of the active routing device if the active routing device fails.
In an *active* state, the routing device is responsible for forwarding all traffic sent to the virtual MAC address of the broadcast domain. There can be only one active and one standby routing device.
Both of these routing devices generate periodic hellos to other routing devices in the group to guarantee that end stations always have a default gateway that can forward their traffic if either of them fails.

if you don't configure preemption, the first routing device that comes up takes on the active role and the second routing device takes on the standby role. Therefore, if you've setting up load balancing between routing devices so that certain routing devices handle traffic for certain VLANs and other routing devices handle traffic for other VLANs, you'll want to use preemption so that whenever a failed routing device comes back online, it resumes its former role.

#### HSRP Configuration

##### Basic Configuration

Only one command, *standby*, is necessary to enable HSRP.

```
Router(config)# interface type [slot_#/]port_#
Router(config-if)# standby [group_#] ip IP_ADDR

or

### using a subinterface for a trunk port and a VLAN interface for an internal routing device (layer 3 switch)

Switch(config)# interface vlan VLAN_#
Switch(config-if)# standby [group_#] ip IP_ADDR
```

Each interface supports 256 HSRP groups. After you execute the *standby* command on an active interface, the routing device enters the learning state. In this command, *group_#* is optional. If you omit it, it defaults to 0.

group_# is required if you have multiple standby groups.

IP address you specify in the *standby* command is not the actual IP address that's on the interface, but rather the virtual IP address. You need to take the virtual IP address and either hard-code it as the default gateway address on end stations or put it in your DHCP server configuration.

To ensure that the end stations do not discover the real MAC address of the routing device's LAN interface, enabling HSRP disables ICMP redirects. You'll see the *no ip redirects* command on the routing device's interface.

##### Load Balancing

To influence which routing devices perform to active and standby roles, you can increase the routing devices priorities. To do so, execute the following *standby* command on the routing device's interface:

```
IOS (config-if)# standby [group_number] priority new_priority
```

Remember that the higher the priority, the more likely it is that the routing device will become a standby or active routing device. The priority defaults to 100 but can be set to a value from 0 to 255.
To configure a routing device so that it can preempt the current standby or active routing device, use the *preempt* parameter

```
Switch(config-if)# standby [group_number] preempt [delay delay_value]
```

The default delay is 0 seconds, which causes the routing device to begin the preemption process immediately. You can delay this by putting in a delay value of 0 to 3600 seconds (1 hour).
The one problem with preemption, however, is that it causes a slight disruption in traffic, because the currently active routing device demotes itself and the new routing device promotes itself.

To modify the hello and hold-down times, execute the following *standby* command:

```
Switch(config-if)# standby [group_#] timers hello_time holddown_time
```

**hello_time** defaults to 3 seconds and can range from 0 to 255 seconds, and **holddown_time** defaults 10 seconds and has the same range of valid values.

the holddown_time value should be at least three times greater than the hello_time value to ensure proper functioning of HSRP.

> It is a common practice to adjust these timers to smaller values to speed up HSRP convergence. If you do this, however, you must be careful not to set these values too small, which may cause inadvertent switchovers.

If you want to configure authentication, execute the following *standby* command on the interface:

```
Router(config-if)# standby [group-number] authentication password
```

the password can be up to eight characters; if omitted, the password default to `cisco`. The password needs to match on all HSRP routers in the same group.

##### Interface Tracking

In certain cases, it may be necessary for the active routing device to step down from its role and let another routing device assume the role.

![[Pasted image 20250822142643.png]]

RP-B is the active RP for VLAN 20. If RP-B fails, RP-A notices this after missing the hello messages from RP-B. Then RP-A promotes itself and stars forwarding frames that are destined to the virtual MAC address.

Let's assume, however, that RP-B does not fail but instead its interface vlan40 fails (connected to the core), Without HSRP running, RP-B would detect the failure and generate an ICMP redirect message to RP-A. This would enable RP-A to handle the redirected traffic. However, if RP-A and RP-B are participating in the HSRP group, ICMP redirects are disabled. This means that RP-B still functions as the active routing device and handles all traffic sent to virtual MAC address. The problem, however, is that after the layer 3 routing protocol has converged, the traffic still reaches its destination. But to reach the destination, the traffic must pass through both RP-B and RP-A, thus introducing unnecessary latency.

![[Pasted image 20250823165719.png]]

To overcome this problem and still be able to deploy HSRP, you can employ the HSRP interface tracking feature. Interface tracking enables the active routing device to lower its priority when one of the interfaces that it's tracking fails. This would enable another RP to assume the active role.

RP-B, with interface tracking configured, would lower its priority essentially telling the other routing devices that it no longer wants to serve as the active routing device. When RP-A sees that RP-B is advertising a lower priority than itself, RP-A prompts itself and handles all traffic destined for the virtual MAC address.

The advantage of this approach is that the traffic from the user will traverse only one RP: RP-A.

To configure interface tracking:

```
Switch(config-if)# standby [group_#] track interface_type interface_# [decrement_value]
```

The **`track`** parameter is used to enter the interface that you want the HSRP RP to track. If this interface fails, for whatever reason, the active routing device decrements its HSRP priority by the configured value.

that `decrement_value` is optional and, if omitted, defaults to a decrement of 10 for the priority.

#### HSRP Verification

To verify the overall operation of HSRP, use the `show standby` command on the RP:

```
Switch# show standby
Vlan 1 - Group 1
  Local state is Active, priority 110, may preempt
  Hellotime 3 holdtime 10
  Next hello sent in 0:00:01
  Hot standby IP address is 172.16.10.1 configured
  Active router is local
  Standby router is 172.16.10.2 expires in 0:00:07
  standby virtual mac address is 0000.0c07.ac01
Tracking interface states for 3 interfaces, 3 up:
  Up Vlan1 Priority decrement: 10
```

In the output, you can see that the active routing device is 172.16.10.1 and the standby RP is 172.16.10.2.

For a shorter description, add the `brief` parameter to the preceding command:

```
Router# show standby brief
```

For additional troubleshooting, you can use the `debug standby` command from privileged EXEC mode. This command displays all HSRP messages that have been sent and received by the RP.

### Other Protocols

* **Virtual Router Redundancy Protocol (VRRP)**
* **Gateway Load Balancing Protocol (GLBP)**

#### VRRP

VRRP performs a similar function as Cisco's proprietary HSRP. The one major downside to HSRP is that it is a proprietary protocol. VRRP, however, is an open standard and is defined in IETF RFC 2338.

Like HSRP, VRRP has end stations that use a virtual router for a default gateway. VRRP is supported for Ethernet media types as well as in VLANs and multiprotocol label switching (MPLS) VPNs.

> HSRP and VRRP are very similar and accomplish the same goal: default gateway redundancy.

One main difference between VRRP and HSRP, however, is that HSRP uses a virtual IP address for the default gateway, whereas VRRP can use either a virtual IP address or the interface address of the master router.

If a virtual IP address is used, an election process takes place to choose a master router. The router with the highest priority is chosen as the master. All other routers are backup routers.

If a real IP address is used, the router that has that address assigned to its interface must be the master router.

VRRP is an IP protocol and has an IP protocol number of 112. The VRRP master router is responsible for generating VRRP multicast messages. It sends these messages to a multicast address of 224.0.0.18. The master typically generates these messages every second. If the master VRRP router fails, a backup VRRP router seamlessly processes the traffic sent to the master router's IP address. This process is referred to as *object tracking*: it ensures that the best VRRP router is selected as the master of the group based on priority and interface tracking. VRRP supports preemption so that a failed master, after it has been repaired, can resume its role as master.

#### GLBP

GLBP is a Cisco-proprietary protocol. like HSRP.

One of the limitations of HSRP and VRRP is that only one router in the HSRP group is active and can forward traffic for one group (the rest of the routers sit idle). This is not an efficient process, because one or more routing devices are not processing any traffic and you are not taking advantage of the bandwidth of the connections that these other routing devices are connected to.

Cisco designed GLBP to rectify this issue. GLBP enables that dynamic assignment of a *group* of virtual addresses to end stations. With GLBP, up to four routing devices in the group can participate in the forwarding of traffic. Plus if a GLBP routing device fails, fault detection occurs automatically and another GLBP routing device picks up the forwarding of packets for the failed routing device.

**Benefits of GLBP**

* Like HSRP, GLBP supports clear-text and MD5 password authentication between GLBP routing devices.
* GLBP supports up to 1024 virtual routers on a routing device.
* GLBP can load balance traffic via four forwarding routing devices in a subnet or VLAN.

#### GLBP Operation

In GLBP, there are two types of routers: **active virtual gateways (AVGs)** and **active virtual forwarders (AVFs)**.

The AVG is the master gateway device and is responsible for assigning virtual MAC address to end stations when the end stations perform an ARP for the GLBP default gateway address. Basically, up to four routing devices configured in the same GLBP are AVFs.

---

## Chapter Review

---

## Quick Review

### Questions
