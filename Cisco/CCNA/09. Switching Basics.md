## Understanding Switch Features

a *switch* is a central connectivity device to which all systems connect in order to communicate with one another.

being able to filter traffic by sending data only to the destination port (while the hub always sends data to all ports), supports full-duplex communication, which means that devices can send and receive at the same time; in hub communication devices were only half-duplex (devices can send and receive, but not at the same time). also have the benefit of being able to be devided into multiple virtual local area networks (VLANs).

Unlike a router, a switch by default, doesn't require that you apply configuration settings. There are, however, a number of features that you can configure on the switch that enable you to tweak how the switch operate and to use advanced features that are not configured by default.

### Switch Functions

Switches are layer 2 devices that is, they operate at the data linke layer of the Open Systems Interconnection (OSI) modell. Although a switch has many capabilities, they do have core functions: they learn, forward, and avoid loops. Switches make all of their switching decisions based on the destination Media Access Control (MAC) address in the header of the frame that is received, and all of the processing is performed in hardware by using application-specific integrated circuits (ASICs). ASICs are specialized processors built to perform very few specific tasks. Because they do only a few things, ASCIs are much more cost-effective than generic processors, such as the one in your PC. Cisco, like most networking vendors, extensively uses ASICs throughout its switching products.

A switch has the following three main funcitons:
* Address learning/MAC learning
	* When a computer sends a frame to another computer and that frame reaches the switch, the switch records the sending MAC address and the port that system is connected to in the MAC table of the switch.
	* Any time the switch receives a frame, it checks the MAC table to see what port the destination systems is connected to
* Filtering/forwarding
	* Switches filter traffic by forwarding the frame only to the port of the destination system(drawing on information the switch has recorded in its MAC table)
* Loop avoidance
	* Switches prevent layer 2 loops on the network by using a loop prevention protocol (such as the Spanning Tree Protocol, STP)

#### Address Learning/MAC learning

One of the three functions of a switch is to learn which devices are connected to which ports of the switch. The switch uses this information to forward frames intelligently.

When a switch receives a frame, it reads the source MAC address in the frame and compares it to a local MAC address table, called a MAC address table or content addressable memory (CAM) table.

If the address is not already in this table, the switch adds the address and the port number on which the frame was received.

![[Pasted image 20250517214854.png]]
Computer B with the MAC address bbbb.bbbb.2222 is sending data. When the switch receives this data it will record that address bbbb.bbbb.2222 is located at port 2 on the switch

If the address is already in the CAM table, the switch compares the incomming port with the port already in the table. If the two are different, the switch updates the CAM table with the new port information.

The CAM table can be built statically or dynamically. By default, when you turn on a switch, the CAM table is empty unless you have configured static entries in it. As traffic flows through the switch, the switch will begin learning address locations based on the source MAC address of the frame and will build its CAM table. This dynamic building process is a very nice feature, because the other method of having addresses appear in the MAC address table is to build them manually using static addresses. With static entries, you must manually add each device's MAC address and the port to which it is connected into the CAM table yourself.

> that switches learn the ports that devices are connected to by analyzing the `source MAC address` of a frame and placing it in the CAM table along with the port that the frame was received on.

#### Filtering and Forwarding

The second function of a switch is known as *frame switching*, or filtering and forwarding, where the switch forwards traffic intelligently. To do this, the switch uses the MAC address table to help it find where destinations are located. When a frame is received on a port, the switch examines the destination MAC address in the frame header and looks for a corresponding entry in the MAC address table. If the switch finds a matching entry, it forwards the frame out of the specified port. If the port is the same port on which the frame was received (the source and destination are connected to the same port), the switch drops the frame. If the switch doesn't find the entry in the MAC address table, the switch floods the frame out all of the remaining ports.

프레임이 스위치로 도착 -> MAC 테이블에서 entry find -> 있으면 그 포트로 보내줌, Source port = destination port 인 경우 frame drop -> entry find 실패한 경우 frame "floods"

> if a switch does not know where to send a frame, it will flood the frame to all ports on the switch
> This is not a broadcast message, however. The difference between frame flooding and a broadcast is that the flooded frame has a specific destination MAC address in the header of the frame, whereas a frame being broadcast has a destination MAC address of FF-FF-FF-FF-FF-FF

### Loop Avoidance

Having layer 2 loops on the network can cause serious problems with the network and even bring the network down. (instability in the MAC address table that confuses the switch and eventually causes the switch to distrust its MAC address table and flood all frames)

![[Pasted image 20250517221722.png]]

Computer A is sending data to Computer B (destination MAC address bbbb.bbbb.2222). When the data leaves Computer A, it is sent to the VAN-SW1 switch on port 3. The VAN-SW1 checks to see if it has the destination MAC address of bbbb.bbbb.bbbb.2222 in its MAC address table and finds that it does not, so it then floods the frame to all ports. This causes the frame to go out port 2 and 24 toward VAN-SW2. When VAN-SW2 receives the frame, it records in the MAC address table that the sending Computer A can be reached via port 1 and port 23 of the VAN-SW2 switch. This is where one of the issues with layer 2 loops occurs: the switch will get confused about wheter it ca trust the data in the MAC address table, because the same system appears to be reached by two different ports.

To correct this problem, Cisco switches use STP, a loop prevention protocol that places one of the ports causing the looop in a blocking state. If a port is in a blocking state, it cannot send or receive any data until it is placed back in a forwarding state. STP will automatically detect when the other link goes down and will change the state to forwarding on the link that was originally blocked.

---
#### Exercise 9-1: Verifying the Loop Avoidance Feature

connect two switches together with redundant links.
After connecting with redundant links, you will witness the switch placing one of the links in a blocking state.

![[Pasted image 20250517222316.png]]

1. Connect port 1 on VAN-SW1 to port 1 on VAN-SW2 using a crossover cable
2. To create fault-tolerant link between the two switches, connect port 24 on VAN-SW1 to port 24 on VAN-SW2 using a crossover cable
	* This will create the fault-tolerant link, but it also creates a loop on the network. The loop is bad, so you will notice that after a minute or so, one link will be green and the other stays amber as it is placed in a blocking state.

---

### Operation Modes

The switching method used affects how a layer 2 device receives, processes, and forwards a frame. Bridges support only one switching method, store-and-forward, while switches may support one, two, or three different switching methods.

* Store-and-forward
* Cut-through
* Fragment-free

#### Store-and-Forward Switching

*Store-and-Forward* switching is the most basic form of switching. With store-and-forward switching, the layer 2 device must receive the entire frame into the buffer of the inbound port and will check the frame for errors (the FCS checksum field on the frame) before the switch will perform any additional processing of the frame. When checking the FCS, commonly called a *cyclic redundancy check (CRC)*, the switch will calculate a CRC value, just as the source device did, and compare this value to what was included in the FCS of the frame. If they are the same, the frame is considered good, and the switch can forward the frame out the correct destination port of the switch. If the FCS value in the frame and computed CRC value are different, the switch will drop the frame.

스위치(layer 2 device)에서 전체 프레임을 받아서 FCS checksum 필드랑 계산한 CRC value를 비교해서 값이 같으면 프레임을 보내고, 값이 다르면 frame drop

The advantage of store-and-forward is that the switch can check the frame for errors before forwarding it on. The downfall is the wait time for the switch to read the entire frame, which is longer that of the other methods.

#### Cut-Through Switching

*Cut-Through* switches were designed to improve the performance of a switch as it relates to processing frames. With cut-through switching, the switch only waits to read the destination MAC address before it begins forwarding the frame. Cut-through switching is faster than store-and-forward switching. Its biggest problem, though, is that the switch may be forwarding bad frames

cut-through 스위치는 destination MAC주소만 읽고 바로 forwarding 해줌. 오류 체크 안함

#### Fragment-Free Switching

*Fragment-free* switching is a modified from of cut-through switching. Whereas cut-through switching reads up to the destination MAC address field in the frame before making a switching decision, fragment-free switching makes sure that the frame is at least 64 bytes long before switching it (64 bytes is the minimum legal size of an Ethernet frame).

The goal of fragment-free switching is to reduce the number of Ethernet runt frames (frames smaller than 64 bytes) that are being switched. Fragment-free switching is sometimes called modified cut-through or runtless switching.

With fragment-free switching, a switch could still be switching corrupt frames, because the switch is checking only the first 64 bytes.

Fragment-Free(modified cut-through, runtless) 스위칭 기법은 프레임이 최소 64바이트 사이즈를 가지고 있는지 확인한 후에 넘겨줌

## Identifying Switch Components

### Chassis and Physical Ports

Every switch model will be a little bit different with regard to the type of interface that exists. Older switches may have only Fast Ethernet (FE) interfaces, some may have mostly FE with Gigabit Ethernet (GE) interfaces to use as uplink ports, or current switches will have all GE interfaces at least

![[Pasted image 20250517233614.png]]

### LEDs and Display Modes

![[Pasted image 20250517233810.png]]

RPS (redundant power supply)

| LED    | Color          | Desc                                                                                               |
| ------ | -------------- | -------------------------------------------------------------------------------------------------- |
| System | Green          | The system is powered on and operational                                                           |
|        | Amber          | The system experienced a malfunction                                                               |
|        | Off            | The system is powered down.                                                                        |
| RPS    | Green          | The RPS is attached and operational.                                                               |
|        | Amber          | The RPS is installed but is not operational.                                                       |
|        | Flashing amber | Both the internal power supply and the external RPS are installed, but the RPS is providing power. |
|        | off            | The RPS is not installed                                                                           |

#### Mode Button

The meaning of the LED above each port on the front of the switch depends on the display mode setting. You can change the display mode by pressing the Mode button.

Just above the Mode button are four port-mode LEDs: STAT(status mode), UTIL (utilization mode), DUPLEX (duplex mode), and SPEED (speed mode). By default, the STAT LED is lit, indicating that the LEDs above the Ethernet ports refer to the status of the port.

**in stat mode**
* Green
	* A physical layer connection exists with a device attached to the port
* Flashing green
	* Traffic is entering and/or leaving the port.
* Amber
	* The port has been disabled manually (shut down) by the administrator, placed in a blocking state due to STP, or disabled because of port security
* Off
	* No physical connection exists on the port

if you push the Mode button, the STAT mode LED turns off and the UTIL LED lights up. This means that each of the LEDs above the port is showing information about the utilization on each port.

**in util mode**
* all ports are green
	* the bandwidth utilization is above 50 percent
* all ports except the last port are green
	* the bandwidth utilization of the switch is between 25 and 49 percent
* all ports except the last two are green
	* the bandwidth utilization of the switch is less than 25 percent

If you press the Mode button once, the display mode LED will change from STAT to DUPLEX. After changing to the DUPLEX mode, the LEDs above each of the ports will reflect the duplex setting of the associated port.

**in duplex mode**
* off
	* the LED above the port is off, the port is set to half duplex
* Green
	* the port is set to full duplex

Press the Mode button again, and the display mode LED will change from DUPLEX to SPEED.

**in speed mode**
* OFF
	* the port is operating at 10 Mbps
* Green
	* the port is operating at 100 Mbps
* Blinking Green
	* the port running at 1 Gbps

If you press the Mode button again, the STAT LED will light. As you can see, you can use the Mode button to cycle through the different display modes to get information about each of the ports. If the display mode LED is either DUPLEX or SPEED, it will automatically change back to STAT after 1 minute

## Basic Switch Configuration

### Initial Configuration Dialog

If no configuration has occurred before the switch boots up, the Internetwork Operating System (IOS) will run the setup script, commonly called initial configuration dialog. This script asks you questions to help create a basic configuration on the switch. When posing questions, the setup script uses brackets ([]) to indicate default values. Leaving an answer blank result in the script accepting the value indicated in brackets for the configuration component.

In the script, you con configure the switch's hostname, set up a privileged EXEC password, assign a password for the virtual type terminals (VTYs), and set up an IP address for a VLAN interface to manage the switch remotely.

> If a switch boots up without a configuration in Non-Volatile RAM (NVRAM), the setup script, or initial configuration dialog, will be presented to the administrator.
> To run the script from the CLI without rebooting the switch, go the privileged EXEC mode and execute the `setup` command

### Basic Settings

#### Naming the Device (set hostname)

If you change the hostname, the prompt within the CLI changes to the hostname, making it easy to know which device you are configuring. Use the hostname global configuration command to modify the name of your device,

```
#### in privileged EXEC mode

IOU1#config t
Enter configuration commands, one per line.  End with CNTL/Z.
IOU1(config)#hostname VAN-SW1
VAN-SW1(config)#
```

#### Assigning an IP Address

switch is a layer 2 device and dose not need an IP address to perform its job of learning and forwarding frames on the network. By assigning an IP address to a switch, however, you can remotely connect to the switch using HTTP, telnet, or SSH. You can remotely manage it instead of depending on connecting through a local console port.

Switches work a bit differently from routers in the sense that you do not assign IP addresses to the ports of the switch. The device that are connected to the ports, such as computers or IP phones, have their IP address assigned. To assign an IP address to a switch, you first navigate to a special VLAN interface then assign the IP to the VLAN of the switch

```
VAN-SW1#config t
Enter configuration commands, one per line.  End with CNTL/Z.
VAN-SW1(config)#interface vlan1
VAN-SW1(config-if)#ip address 12.0.0.2 255.0.0.0
VAN-SW1(config-if)#no shutdown
VAN-SW1(config-if)#
*Jul  5 07:18:28.805: %LINK-3-UPDOWN: Interface Vlan1, changed state to up
*Jul  5 07:18:29.808: %LINEPROTO-5-UPDOWN: Line protocol on Interface Vlan1, changed state to up
VAN-SW1(config-if)#
```

navigate to the vlan1 (default VLAN) by using the `interface` command. Once at the interface prompt, you use the IP address command to assign an IP address and subnet mask to the switch. You then must enable the interface by using `no shutdown` command.

#### Setting Up a Default Gateway

Once you've assigned the IP address and subnet mask, you can remotely administer the switch as long as you are on the same network as the switch. If you want to administer the switch from a different network, you must configure a default gateway so that the switch knows how to send data off the network. To configure a default gateway on the switch, use the following commands:

```
VAN-SW1#config t
Enter configuration commands, one per line.  End with CNTL/Z.
VAN-SW1(config)#ip default-gateway 12.0.0.1
VAN-SW1(config)#
```

`ip default-gateway` command to set the default gateway

#### Exercise 9-2: Configuring a Switch

![[Pasted image 20250705162413.png]]

> it is good practice to ensure that your lab environment is not connected to any production network and is isolated

ComputerA is connected to port 5 of VAN-SW1, while ComputerB is connected to port 15 of VAN-SW1. ComputerC is connected to port 5 of LA-SW1, while ComputerD is connected to port 15 on LA-SW1.

**Configuring VAN-SW1**

```
IOU1#config t
Enter configuration commands, one per line.  End with CNTL/Z.

### change hostname
IOU1(config)#hostname VAN-SW1

### assign ip address
VAN-SW1(config)#interface vlan1
VAN-SW1(config-if)#ip address 12.0.0.2 255.0.0.0
VAN-SW1(config-if)#no shutdown
VAN-SW1(config-if)#exit
VAN-SW1(config)#
*Jul  5 08:03:32.563: %LINK-3-UPDOWN: Interface Vlan1, changed state to up
*Jul  5 08:03:33.566: %LINEPROTO-5-UPDOWN: Line protocol on Interface Vlan1, changed state to up

### set default gateway
VAN-SW1(config)#ip default-gateway 12.0.0.1

### verify
VAN-SW1#show interface vlan1
Vlan1 is up, line protocol is up
  Hardware is Ethernet SVI, address is aabb.cc80.0100 (bia aabb.cc80.0100)
  Internet address is 12.0.0.2/8
  MTU 1500 bytes, BW 1000000 Kbit/sec, DLY 10 usec,
     reliability 255/255, txload 1/255, rxload 1/255
  Encapsulation ARPA, loopback not set
  Keepalive not supported
  ARP type: ARPA, ARP Timeout 04:00:00
  Last input never, output never, output hang never
  Last clearing of "show interface" counters never
  Input queue: 0/75/0/0 (size/max/drops/flushes); Total output drops: 0
  Queueing strategy: fifo
  Output queue: 0/40 (size/max)
  5 minute input rate 0 bits/sec, 0 packets/sec
  5 minute output rate 0 bits/sec, 0 packets/sec
     0 packets input, 0 bytes, 0 no buffer
     Received 0 broadcasts (0 IP multicasts)
     0 runts, 0 giants, 0 throttles
     0 input errors, 0 CRC, 0 frame, 0 overrun, 0 ignored
     2 packets output, 120 bytes, 0 underruns
     0 output errors, 0 interface resets
     0 unknown protocol drops
     0 output buffer failures, 0 output buffers swapped out
VAN-SW1#
```

**Configuring LA-SW1**

```
IOU2#config t
Enter configuration commands, one per line.  End with CNTL/Z.

### change hostname
IOU2(config)#hostname LA-SW1
LA-SW1(config)#interface vlan1
LA-SW1(config-if)#ip address 14.0.0.2 255.0.0.0
LA-SW1(config-if)#no shutdown
LA-SW1(config-if)#exit
LA-SW1(config)#
*Jul  5 08:08:28.871: %LINK-3-UPDOWN: Interface Vlan1, changed state to up
*Jul  5 08:08:29.874: %LINEPROTO-5-UPDOWN: Line protocol on Interface Vlan1, changed state to up

### set default gateway
LA-SW1(config)#ip default-gateway 14.0.0.1
LA-SW1(config)#exit

### verify
LA-SW1#show interface vlan1
Vlan1 is up, line protocol is up
  Hardware is Ethernet SVI, address is aabb.cc80.0200 (bia aabb.cc80.0200)
  Internet address is 14.0.0.2/8
  MTU 1500 bytes, BW 1000000 Kbit/sec, DLY 10 usec,
     reliability 255/255, txload 1/255, rxload 1/255
  Encapsulation ARPA, loopback not set
  Keepalive not supported
  ARP type: ARPA, ARP Timeout 04:00:00
  Last input never, output never, output hang never
  Last clearing of "show interface" counters never
  Input queue: 0/75/0/0 (size/max/drops/flushes); Total output drops: 0
  Queueing strategy: fifo
  Output queue: 0/40 (size/max)
  5 minute input rate 0 bits/sec, 0 packets/sec
  5 minute output rate 0 bits/sec, 0 packets/sec
     0 packets input, 0 bytes, 0 no buffer
     Received 0 broadcasts (0 IP multicasts)
     0 runts, 0 giants, 0 throttles
     0 input errors, 0 CRC, 0 frame, 0 overrun, 0 ignored
     2 packets output, 120 bytes, 0 underruns
     0 output errors, 0 interface resets
     0 unknown protocol drops
     0 output buffer failures, 0 output buffers swapped out
LA-SW1#
```

### MAC Address Table

MAC address are associated with which interfaces or ports on the switch. this information is stored in the MAC address table, or CAM table. On newer switches, you can view the MAC address table by using the `show mac address-table` command:

```
VAN-SW1#show mac address-table
          Mac Address Table
-------------------------------------------

Vlan    Mac Address       Type        Ports
----    -----------       --------    -----
   1    0050.0fdd.d03a    DYNAMIC     Gig1/0/1
   2    0090.0c9e.76a8    DYNAMIC     Gig1/0/5
```

that two MAC addresses are stored in the CAM table: one associated with Fa0/1 and the other, Fa0/5. these entries are automatically created based on the switch receiving traffic through these ports.

> if a destination MAC address is not in the table (unknown), the switch will flood the frame to all ports on the switch.

> to clear dynamically learned entries from the CAM table, use the `clear mac address-table` command from privileged EXEC mode.

> On older Cisco switches, use the `show mac-address-table` and `clear mac-address-table` command

### Static MAC Addresses

you can manually create static entries. The benefit of static entries is that they are part of your switch configuration, so they are  retained even if the switch is rebooted (whereas dynamic entries are lost after a reboot and must be learned again).

To add a static entry in the MAC address table, use the following syntax:

```
Switch (config)# mac address-table static <MAC_ADDRESS> vlan <VLAN_#> interface <type module/port_#>
```

In addition to specifying the MAC address of the device and the interface where the device is located, you must also specify the VLAN in which the device is located. Use the `show mac-address-table` command to view your new entries. To remove a static entry from the CAM table, preface the command with the `no` parameter: `no show mac-address-table`
## Interface Configuration

configuring the ports on the switch
* configure basic settings on a port
* how to limit which systems can connect to a port with the port security feature.

### Configuring Ports

* add a port description
* configure the switch speed
* configure the duplex setting
* enable and disable a port
* verify port settings

#### Adding a Port Description
 
```
VAN-SW1#config t
Enter configuration commands, one per line.  End with CNTL/Z.

### interface Ethernet 1/0
VAN-SW1(config)#interface E1/0
VAN-SW1(config-if)#description to Router
VAN-SW1(config-if)#exit

### interface Ethernet 0/0
VAN-SW1(config)#interface E0/0
VAN-SW1(config-if)#description to PC1
VAN-SW1(config-if)#exit

### interface Ethernet 0/1
VAN-SW1(config)#interface E0/1
VAN-SW1(config-if)#description to PC2
VAN-SW1(config-if)#exit
VAN-SW1(config)#

### description check

VAN-SW1(config)#do show interface E1/0
Ethernet1/0 is up, line protocol is up (connected)
  Hardware is AmdP2, address is aabb.cc00.0101 (bia aabb.cc00.0101)
  Description: to Router
  MTU 1500 bytes, BW 10000 Kbit/sec, DLY 1000 usec,
     reliability 255/255, txload 1/255, rxload 1/255
  Encapsulation ARPA, loopback not set
  Keepalive set (10 sec)
  Auto-duplex, Auto-speed, media type is unknown
  input flow-control is off, output flow-control is unsupported
  ARP type: ARPA, ARP Timeout 04:00:00
  Last input never, output 00:00:00, output hang never
  Last clearing of "show interface" counters never
  Input queue: 0/2000/0/0 (size/max/drops/flushes); Total output drops: 0
  Queueing strategy: fifo
  Output queue: 0/0 (size/max)
  5 minute input rate 0 bits/sec, 0 packets/sec
  5 minute output rate 0 bits/sec, 0 packets/sec
     0 packets input, 0 bytes, 0 no buffer
     Received 0 broadcasts (0 multicasts)
     0 runts, 0 giants, 0 throttles
     0 input errors, 0 CRC, 0 frame, 0 overrun, 0 ignored
     0 input packets with dribble condition detected
     140975 packets output, 9931122 bytes, 0 underruns
     200 output errors, 200 collisions, 0 interface resets
     0 unknown protocol drops
     0 babbles, 0 late collision, 0 deferred
     0 lost carrier, 0 no carrier
     0 output buffer failures, 0 output buffers swapped out
```

#### Configuring Switch Speed

> 10 Mbps (Ethernet)
> 100 Mbps (Fast Ethernet)
> 1000 Mbps (Gigabit Ethernet)
> 8bit = 1byte

The switch will detect the speed of the device that is connected to it and run the port at that speed.

To configure the speed on the port manually, you can navigate to the port using the interface global configuration command:
```
# set speed to single interface
VAN-SW1(config)#interface g1/0/1
VAN-SW1(config-if)#speed ?
10    Force 10 Mbps operation
100   Force 100 Mbps operation
1000  Force 1000 Mbps operation
auto  Enable AUTO speed configuration
VAN-SW1(config-if)# speed 1000

# set speed to multiple interfaces
VAN-SW1(config)#interface range g1/0/1 - 24
VAN-SW1(config-if-range)#speed 1000
```

#### Configuring Duplex Setting

You can configure the duplex setting on your ports using the `duplex` command on the interface.

```
VAN-SW1(config)#interface E1/0
VAN-SW1(config-if)#duplex ?
  auto  Enable AUTO duplex configuration
  full  Force full duplex operation
  half  Force half-duplex operation

VAN-SW1(config-if)#duplex full
VAN-SW1(config-if)#
```

#### Enabling and Disabling Ports

**Disable Interfaces**
To disable a port, navigate to the interface of the port you want to disable and then use the `shutdown` command.

**Enable Interfaces**
If a port has been disabled (administratively down), you can enable it with the `no shutdown` command

```
### Disable Interface
VAN-SW1(config-if)#shutdown
VAN-SW1(config-if)#
*Jul  9 02:46:12.022: %LINK-5-CHANGED: Interface Ethernet0/3, changed state to administratively down
*Jul  9 02:46:13.023: %LINEPROTO-5-UPDOWN: Line protocol on Interface Ethernet0/3, changed state to down

### check Interface status
VAN-SW1(config-if)#do show interface E0/3
Ethernet0/3 is administratively down, line protocol is down (disabled)
  Hardware is AmdP2, address is aabb.cc00.0130 (bia aabb.cc00.0130)
  MTU 1500 bytes, BW 10000 Kbit/sec, DLY 1000 usec,
     reliability 255/255, txload 1/255, rxload 1/255
  Encapsulation ARPA, loopback not set
  Keepalive set (10 sec)
  Auto-duplex, Auto-speed, media type is unknown
  input flow-control is off, output flow-control is unsupported
  ARP type: ARPA, ARP Timeout 04:00:00
  Last input never, output 00:00:16, output hang never
  Last clearing of "show interface" counters never
  Input queue: 0/2000/0/0 (size/max/drops/flushes); Total output drops: 0
  Queueing strategy: fifo
  Output queue: 0/0 (size/max)
  5 minute input rate 0 bits/sec, 0 packets/sec
  5 minute output rate 0 bits/sec, 0 packets/sec
     0 packets input, 0 bytes, 0 no buffer
     Received 0 broadcasts (0 multicasts)
     0 runts, 0 giants, 0 throttles
     0 input errors, 0 CRC, 0 frame, 0 overrun, 0 ignored
     0 input packets with dribble condition detected
     141412 packets output, 9962035 bytes, 0 underruns
     219 output errors, 219 collisions, 0 interface resets
     0 unknown protocol drops
     0 babbles, 0 late collision, 0 deferred
     0 lost carrier, 0 no carrier
     0 output buffer failures, 0 output buffers swapped out

### Enable Interface
VAN-SW1(config-if)#no shutdown
VAN-SW1(config-if)#
*Jul  9 02:47:23.400: %LINK-3-UPDOWN: Interface Ethernet0/3, changed state to up
*Jul  9 02:47:25.413: %LINEPROTO-5-UPDOWN: Line protocol on Interface Ethernet0/3, changed state to upe

### check Interface status
VAN-SW1(config-if)#do show interface E0/3
Ethernet0/3 is up, line protocol is up (connected)
  Hardware is AmdP2, address is aabb.cc00.0130 (bia aabb.cc00.0130)
  MTU 1500 bytes, BW 10000 Kbit/sec, DLY 1000 usec,
     reliability 255/255, txload 1/255, rxload 1/255
  Encapsulation ARPA, loopback not set
  Keepalive set (10 sec)
  Auto-duplex, Auto-speed, media type is unknown
  input flow-control is off, output flow-control is unsupported
  ARP type: ARPA, ARP Timeout 04:00:00
  Last input never, output 00:00:00, output hang never
  Last clearing of "show interface" counters never
  Input queue: 0/2000/0/0 (size/max/drops/flushes); Total output drops: 0
  Queueing strategy: fifo
  Output queue: 0/0 (size/max)
  5 minute input rate 0 bits/sec, 0 packets/sec
  5 minute output rate 0 bits/sec, 0 packets/sec
     0 packets input, 0 bytes, 0 no buffer
     Received 0 broadcasts (0 multicasts)
     0 runts, 0 giants, 0 throttles
     0 input errors, 0 CRC, 0 frame, 0 overrun, 0 ignored
     0 input packets with dribble condition detected
     141428 packets output, 9964556 bytes, 0 underruns
     219 output errors, 219 collisions, 0 interface resets
     0 unknown protocol drops
     0 babbles, 0 late collision, 0 deferred
     0 lost carrier, 0 no carrier
     0 output buffer failures, 0 output buffers swapped out
```

#### Verifying Port Settings

`do show interfaces E0/0`

### Understanding Port Security

Port security is a switch feature that enables you to lock down switch ports based on the MAC address or addresses associated with the interface; this prevents unauthorized access to a LAN.

ex) you could configure port security on port g0/5 for the MAC address of aaaa.aaaa.1111, specifying that the system with that MAC address is the only authorized device for that port. If any other system connects to that port, a security violation results. As an administrator, you control what should happen when a violation occurs, be it generating a notification about the issue, dropping traffic for the MAC address that caused the violation, or completely disabling the port where the violation occurred.

The port security feature will not work on trunk ports, Switch Port Analyzer (SPAN) ports, and EtherChannel ports. However, it is compatible with 802.1X and voice VLANs,

#### Port Security Configuration

The port security feature is configured per interface with a number of `switchport` commands.

```
switch(config-if)# switchport mode access
switch(config-if)# switchport port-security
switch(config-if)# switchport port-security maximum <value>
switch(config-if)# switchport port-security violation
								protect|restrict|shutdown
switch(config-if)# switchport port-security mac-address <MAC_ADDRESS>

VAN-SW1(config-if)#switchport ?
  access         Set access mode characteristics of the interface
  autostate      Include or exclude this port from vlan link up calculation
  dot1q          Set interface dot1q properties
  host           Set port host
  mode           Set trunking mode of the interface
  port-security  Security related command
  private-vlan   Set the private VLAN configuration
  trunk          Set trunking characteristics of the interface
  voice          Voice appliance attributes
  <cr>

VAN-SW1(config-if)#switchport mode ?
  access        Set trunking mode to ACCESS unconditionally
  dot1q-tunnel  set trunking mode to TUNNEL unconditionally
  private-vlan  Set private-vlan mode
  trunk         Set trunking mode to TRUNK unconditionally

VAN-SW1(config-if)#switchport port-security ?
  aging        Port-security aging commands
  mac-address  Secure mac address
  maximum      Max secure addresses
  violation    Security violation mode
  <cr>

```

1. enter the appropriate interface where you want to set up port security
2. `switchport mode access`, places the interface in access mode
3. `switchport port-security`, enables port-security (it is disabled by default)
4. `switchport port-security maximum`, specifies the maximum number of devices that can be associated with the interface. This defaults to 1 and can range from 1 to 132.
5. `switchport port-security violation`, specifies what should occur if a security violation occurs (a different MAC address is connected to the port.)
	* **Protect command**
		* This command sends an alert to the administrator when an unauthorized device is connected to the port
	* **Restrict command**
		* The `restrict` setting results in the port being able to forward frames for the authorized device only. If an unauthroized device connects to the port, the switch will drop those frames
	* **Shutdown command**
		* With this command, the port is disabled the second and authorized device connects to the port. The port is disabled until the administrator issues the `no shutdown` command This is the default violation mode if you don't specify the mode.
6. `switchport port-security mac-address <MAC_ADDRESS>`, lets you specify the exact MAC address that is allowed to be associated with this interface

#### Sticky Learning

Port security is a great feature and very common on networks to prevent unauthorized devices from connecting an enabled port on the switch. The problem is, however, that is poses a huge administrative burden to set up, because you have to specify the MAC address of authorized devices on each port.

use the `sticy` option instead of a MAC address. When you use the `sticy` option, the switch will dynamically learn the MAC address of the system already connected to the port and then configure the port security feature using that MAC address.

```
switch(config-if)# switchport mode access
switch(config-if)# switchport port-security
switch(config-if)# switchport port-security maximum <value>
switch(config-if)# switchport port-security violation
								protect|restrict|shutdown
switch(config-if)# switchport port-security mac-address sticky
```

#### Port security Verification

To check which ports you have configured port security on and also view the security action and violation count, use the `show port-security` command

```
VAN-SW1#show port-security
Secure Port  MaxSecureAddr  CurrentAddr  SecurityViolation  Security Action
                (Count)       (Count)          (Count)
---------------------------------------------------------------------------
      Et0/3              1            0                  0         Shutdown
---------------------------------------------------------------------------
Total Addresses in System (excluding one mac per port)     : 0
Max Addresses limit in System (excluding one mac per port) : 4096
```

To see the MAC address that are statically defined or dynamically learned with port security, use the `show port-security address` command:

```

VAN-SW1#show port-security address
               Secure Mac Address Table
-----------------------------------------------------------------------------
Vlan    Mac Address       Type                          Ports   Remaining Age
                                                                   (mins)
----    -----------       ----                          -----   -------------
-----------------------------------------------------------------------------
Total Addresses in System (excluding one mac per port)     : 0
Max Addresses limit in System (excluding one mac per port) : 4096
VAN-SW1#
```

to see a bit more port security detail on a specific port, use the `show port-security interface` command

```
VAN-SW1#show port-security interface E0/3
Port Security              : Enabled
Port Status                : Secure-up
Violation Mode             : Shutdown
Aging Time                 : 0 mins
Aging Type                 : Absolute
SecureStatic Address Aging : Disabled
Maximum MAC Addresses      : 1
Total MAC Addresses        : 0
Configured MAC Addresses   : 0
Sticky MAC Addresses       : 0
Last Source Address:Vlan   : 0000.0000.0000:0
Security Violation Count   : 0

VAN-SW1#
```

## Working with VLANs

A *virtual LAN* (VLAN) is a logical grouping of network devices in the same broadcast domain that can span across multiple switches.

![[Pasted image 20250716025034.png]]

where every device is in both the same collision and broadcast domains. In this example, a hub is providing the connectivity, which represents, to the devices connected to it, that the segment is a logical segment.

![[Pasted image 20250716025051.png]]

this example shows an example of a switch with four PCs connected to it. One major difference between the switch and the hub is that all devices connected to the hub are in the same collision domain, whereas in the switch example, each port of the switch is a separate collision domain. By default, all ports on the switch are in the same broadcast domain.

In this example, however, the configuration of the switch places PC-E and PC-F in one broadcast domain (VLAN) and PC-G and PC-H in another broadcast domain.

Switches are used to create VLANs, or separate broadcast domains. VLANs are not restricted to any physical boundary in the switched network, assuming that all the devices are interconnected via switches and that there are no intervening layer 3 devices. For example, a VLAN could be spread across multiple switches, or it could be contained in the same switch

![[Pasted image 20250716025636.png]]

This example shows three VLANs, Notice PC-F are in same VLAN but are connected to different ports of different switches. However, a VLAN could be contained to one switch, as PC-C and PC-D are connected to SwitchA

The switches in your network maintain the integrity of your VLANs. For example, if PC-A generates a broadcast, SwitchA and SwitchB will make sure that only other devices in that VLAN (PC-B, PC-E, and PC-F) will see the broadcast, and that other devices will not, and that holds ture even across switches

> VLAN is a group of devices in the same broadcast domain or subnet. VLANs are good at logically separating/segmenting traffic between different groups of users.
> 
> VLANs contain/isolate broadcast traffic, where you need a router to move traffic between VLANs. VLANs create separate broadcast domains; they increase the number of broadcast domains but decrease the size of the broadcast domains.

### Subnets and VLANs

Logically, VLANs are also subnets. A subnet, or a network, is a contained broadcast domain. A broadcast that occurs in one subnet will not be forwarded, by default, to another subnet. Routers, or layer 3 devices, provide this boundary function. Each of these subnets requires a unique network number. And to move from one network number to another, you need a router. In the case of broadcast domains and switches, each of these separate broadcast domains is a separate VLAN; therefore, you still need a routing function to move traffic between different VLANs.

1. a switch can handle multiple VLANs on a single port, and a router can route between these VLANs on the same single port if that port is designed as a *trunk* port
2. that a VLAN is a broadcast domain, so if you want to optimize traffic, it is recommended that a VLAN not exceed 500 devices.

### Scalability

Through segmentation of broadcast domains, VLANs increase your network's scalability. Because VLANs are a logical construct, a user can be located anywhere in the switched network and still belong to the same broadcast domain. If you can still keep the user in his or her original VLAN. This includes a move from one floor of a building to another floor or from one of the campus to another. The limitation is that the user, when moved, must still be connected to the same layer 2 network.

### VLANs and Traffic Types

Many network administrators use VLANs not only to separate different types of user traffic (commonly separated by job function), but also to separate based on the type of traffic, placing network management, multicast and voice over IP (VoIP) traffic into their own distinctive VLANs.

Network management traffic is traffic generated by the different protocols and features of network devices in order to help discover, monitor, and maintain devices on the network. Some examples of network management traffic may be SNMP traffic, NTP traffic, CDP traffic, and syslog traffic.
Network management traffic may also involve device configuration backups and network upgrade traffic. As a network designer you may decide to have some of this traffic on its own segment.

Multicast traffic is commonly used by video applications to transmit video streams intelligently from a server to one or more clients interested in seeing it, where UDP is used as a transport for the video stream. An example of a video solution is uses multicasts is Cisco's IP/TV server.

Video traffic is delay sensitive too much delay can be noticeable by the end user, because the actual video picure looks jumpy and jagged.
By separating this traffic from other types through VLANs, and by setting up the necessary quality of service (QoS) for this VLAN traffic, you can help minimize or prevent delay issues.

VoIP traffic includes two kinds of traffic: signaling information sent from the VoIP phones to the VoIP gateway products, such as Cisco Unified Communications Manager (formerly called Cisco CallManager), and the actual voice conversations, which use UDP as a transport between VoIP phones and/or digital phones connected to VoIP PBXs.
One issue with VoIP traffic is that it is delay-sensitive, so mixing this kind of traffic with other data types can cause performance issues that are very noticeable on voice connections. Therefore, separating this traffic in its own VLAN and using QoS to ensure that this kind of traffic is given higher priority than other types is an important design consideration.

Some Cisco Catalyst switches support a special type of VLAN, called a *voice* VLAN. With the voice VLAN feature, switches will automatically place a Cisco VoIP phone into the voice VLAN once the VoIP phone is plugged into the switch. The advantage of this approach is that when a VoIP phone is added to the network, you, as an administrator, no longer have to worry about configuring the switch to place the phone into the correct VLAN

> Different types of traffic, such as delay-sensitive voice or video traffic (multicast), network management traffic, and data application traffic, should be separated into different VLANs via connected switches to prevent problems of one traffic type affecting the performance of other types of traffic. QoS can be used to prioritize traffic types such as VoIP and video to ensure that they receive the necessary bandwidth and are prioritized over other types of data traffic


### VLAN Membership

A device's membership is a VLAN can be determined by one of three methods: static, dynamic, or voice. These methods affect how a switch will associate a port in its chassis with a particular VLAN.

* **static**
	* you must manually assign a port on a switch to a VLAN using an `interface subconfiguration` mode command.
	* VLANs configured in this way are typically called *port-based* VLANs
* **dynamic**
	* the switch automatically assigns the port to a VLAN using information from the user device, such as its MAC address, IP address, or even then consults a policy server, called a *VLAN membership policy server*(VMPS), witch is proprietary to Cisco and contains a mapping of device information to VLANS. One of the switches in your network must be configured as this server. Low-end Cisco switches cannot serve as VMPS server switches,
* **802.1X authentication**
	* which is used to authenticate a device's access to a switch or wireless access point.
	* The authentication credentials are stored on an authentication server. One policy you can assign to the user account (associated with the authenticating device) on the authentication server is the VLAN to which the device belongs the server can pass this to the layer 2 device, which in turn, can associate the VLAN to the port with which the authenticated device is associated.

Dynamic VLANs have one main advantage over static VLANs: they support plug-and-play movability. For instance, if you move a PC from a port on one switch to a port on another switch and you are using dynamic VLANs, the new switch port will automatically be configured for the VLAN to which the user belongs. About the only time that you have to configure information with dynamic VLANs is if you hire an employee and the employee leaves the company or changes job functions

If you are using static VLANs, not only will you have to configure the switch port manually with this updated information, but if you move the user from one switch to another, you will also have to perform this manual configuration to reflect the user's new port. One advantage, though, that static VLANs have over dyanmic VLANs is that the configuration process is easy and straightforward. Dynamic VLANs require a log of initial prearation involving matching users to VLANs.

Voice VLANs are unique. They are associated to ports that have VoIP phones attached. Some VoIP phones may have a multiport switch attached to them to enable other devices to connect to the switch via the phone. In this instance, the phone may tag frames to indicate which device is sending the traffic phone or computer so that the switch can then deal with the traffic correctly.

## VLAN connections

When dealing with VLANs, switches support two types of switch ports: access ports and trunk ports. When setting up your switches, you will need to know what type of connection an interface should use then configure it appropriately. As you will see, the configuration process for each type of interface is different.

### Access Ports

An access port provides a connection to a device that has a standardized

Ethernet NIC that understands only standardized Ethernet frames in other words, a normal NIC that understands IEEE 802.3 and Ethernet II frames.

Access port connections can be associated only with a single VLAN (voice VLAN ports are an exception to this). This means that any device or devices connected to this port will be in the same broadcast domain.

For example, if ten users are connected to a hub, and you plug the hub into an access port interface on a switch, then all of these users will belong to the same VLAN that is associated with the switch port. If you wanted five users on the hub to belong to one VLAN and other five to a different VLAN, you would need to purchase an additional hub and plug each hub into a different switch port. Then, on the switch, you would need to configure each of these ports with the correct VLAN identifier.

>  an access port is used to connect and end-point device, such as server, a workstation, or a laptop, to the network via that t. An access port is typically associated with a single VLAN.

### Trunk Ports for Interswitch Connectivity

Unlike access ports, *trunk* ports are capable of carrying traffic for multiple VLANs and are configured on ports that are connecting to other switches. To support trunking, the original Ethernet frame must be modified to carry VLAN information, commonly called a *VLAN identifier* or number. This ensures that the broadcast integrity is maintained.

For instance, if a device from VLAN 1 has generated a broadcast and the connected switch has received it, when his switch forwards it to other switches, these switches need to know the VLAN origin so that the VLAN origin so that they can forward this frame out only VLAN 1 ports and not other VLAN ports.

Cisco supports two Ethernet trunking methods:

* Cisco's proprietary InterSwitch Link (ISL) protocol for Ethernet
* IEEE 802.1Q, commonly referred to as *dot1q* for Ethernet

> a trunk modifies the original frame to carry VLAN information, including a VLAN identifier in the frame. IEEE 802.1Q defines a standard method of VLAN trunking.
> 
> A trunk connection between two switches enables the same VLANs on the two switches to intercommunicate (like VLAN 2 devices on both switches).


Cisco's high-end switches, such as the Catalyst 6500s, support both methods; however, Cisco's low-end switches support only 802.1Q: ISL is being phased out by Cisco.

#### Trunk Tagging

Trunking methods create the illusion that instead of a single physical connection between the two trunking devices, a separate logical connection exists for each VLAN between them. When trunking, the switch adds the source port's VLAN identifier to the frame so that the device (typically a switch) at the other end of the trunk understands what VLAN originated this frame and the destination switch can make intelligent forwarding decisions on not just the destination MAC address, but also the source VLAN identifier

Since information is added to the original Ethernet frame, normal NICs will not understand this information and will typically drop the frame. Therefore, you need to ensure that when you set up a trunk connection on a switch's interface, the device at the other end also supports the same trunking protocol and has it confugred. If the device at the other end doesn't understand these modified frames or is not set up for trunking, it will, in most situations, drop them.

The modification of these frames, commonly called *tagging*, is done in hardware by application-specific integrated circuits (ASICs). ASICs are specialized processors. Since the tagging is done in hardware at faster than wire speeds, no latency is envolved in the actual tagging process. And to ensure compatibility with access port devices, switches will strip off the tagging information and forward the original Ethernet frame to the device or devices connected to access port connections.

From the user's perspective, the source generates a normal Ethernet frame an the destination receives this frame, which is an Ethernet 802.3 or II frame comming in and the same going out. In reality, this frame is tagged as it enteres the switched infrastructure and shed the tas as it exits the infrastructure; the process of tagging and untagging the frame is hidden from the users connected to access ports

#### Trunk-Capable Devices

Trunk links are common between certain types of devices, including switch-to-switch, switch-to-router, and switch-to-file server connections.

Using a trunk link on a router is a great way of reducing your layer 3 infrastructure costs.

For instance, in the old days of bridging, in order to router between different broadcast domains, you needed a *separate* physical router interface between for each broadcast domain. So if you had two broadcast domains, you needed two router ports; if you had 20 broadcast domains, you needed 20 router ports.

Today, with the advent of VLANs and trunk connections, you can use a single port on a router to route between your multiple broadcast domains. Whether you have 2 or 20 broadcast domains, you can use just one port on the router to accomplish the routing between these different subnets.

If your router doesn't support trunking, you would need a separate router interface for each VLAN you created to route between the VLANs. Therefore, if you have a lot of VLANs, it makes sense to economize and buy a router and the correct type of interface that supports trunking.

> Routing between VLANs is great use of layer 3 switches (switches that have routing functionality as well). You could have a layer 3 core switch, with all the VLANs configured, performing the job of routing internally.

You can also purchase specialized NICs for PCs or servers, such as file servers or virualization servers, that support trunking.

For instance, suppose you want multiple VLANs to access a file server. You could use a normal NIC and setup with an access port connection to a switch Because this is an access port connection, the server could belong only to one VLAN. The users in the same VLAN, when accessing the server, would have all their traffic switched via layer 2 devices to reach it. Users in other VLANs, however, would require hat their traffic be routed to this server via a router, since the file server is in a different broadcast domain.

> If the same VLANs are on two connected switches, use a trunk connection between the switches to enable the associated VLANs on each side to communicate with each other. Trunk connections are commonly used on routers so that routers, via subinterfaces, can route between the VLANs. The trunking encapsulation, however, must match between the two trunking devices (such as using 802.1Q on both sides, or Cisco's Proprietary ISL on both sides).

If throughput is a big concern, you may want to buy a trunk NIC for the file server. Configuring this NIC is different from configuring a normal NIC on a file server. For each VLAN in which you want the file server to participate, you would create a virtual NIC, assign your VLAN identifier and layer 3 addressing to the virtual NIC for the specific VLAN, and then associate it with the physical NIC.

Once you have created all of these logical NICs on your file server, you need to set up a trunk connection on the switch to the server. And once you have done this, members of VLANs in the switched network will be able to access the file server directly without going through a router. These trunk-capable NICs are common enough today that you may even see them in certain PCs, since the NICs are commonly used to support virtualization

> A good example of a device that may need a trunk-capable NIC is a DHCP server, because it may need to assign IP addresses to users across multiple VLANs.
> If you don't have a trunk-capable NIC, but users are spread across multiple VLANs, you could use the IP helper feature on a Cisco router connected to users' VLANs and have the router forward the DHCP broadcasts to the DHCP server located in a different VLAN.
> 
> Another example of a device that may need a trunk-capable NIC is a server in a data center: this is commonly necessary to support the many virtual machines (VMs) running on the serer.

#### Trunking Example

![[Pasted image 20250720081013.png]]

example of trunk connection between SwitchA and SwitchB in a network that has three VLANs.

PC-A, PC-F and PC-H belong to one VLAN; PC-B and PC-G belong to second VLAN; and PC-C, PC-D, and PC-E belong to a third VLAN.

The trunk between the two switches is also tagging VLAN information so that the remote switch understands the source VLAN of the originator.

![[Pasted image 20250720082217.png]]

In this example, PC-C generates a local broadcast, it examines the incomming port and knows that the source device is from the gray VLAN (the access port connections are marked with dots). Seeing this, the switch knows to forward this frame only out of ports that belong to the same VLAN: this includes access port connections with the same VLAN identifier and trunk connections. On this switch, one access port connection belongs to the same VLAN, PC-D, so the switch forwards the frame directly out this interface.

The trunk connection between SwitchA and SwitchB handles traffic for multiple VLANs. A VLAN tagging mechanism is required to differentiate the source of traffic when moving it between the switches.

For instance, assume that no tagging mechanism took place between the switches. PC-C generates a broadcast frame, and SwitchA forwards it unaltered to PC-D and then SwitchB across the trunk. The problem with this process is that when Switch B receives the original Ethernet frame, it has no idea what port or ports to forward the broadcast to, since dosen't know the origin VLAN.

SwitchA tags the broadcast frame, adding the source VLAN to the original Ethernet frame (the broadcast frame is tagged). When SwitchB receives the frame, it examines the tag and knows that this is meant only for the VLAN to which PC-E belongs.

since  PC-E is connected via an access port connection, SwitchB first strips off the tagging and then forwards the original Ethernet frame to PC-E. because PC-E has a standard NIC and doesn't understand VLAN tagging.

Through this process, both switches maintain the integrity of the broadcast domain.

#### IEEE 802.1Q

InterSwitch Link (ISL), a Cisco proprietary protocol, is being phased out in Cisco's products and being replaced with the IEEE 802.1Q trunking standard, which was introduced 1998. One of the advantages provided by the IEEE standard is that it allows trunks between different venders' devices, whereas ISL is supported only on certain Cisco devices. Therefore, by using 802.1Q you should be able to implement a multivendor trunking solution without having to worry about whether or not a specific type of trunk connection is or is not supported.

The 2916 and better switches, along with Cisco's higher-end switches such as the 6500 series, support 802.1Q. Actually, the new switch models support *only* 802.1Q trunking they don't support ISL at all. 802.1Q trunking is supported on switch ports that are capable of either Fast Ethernet or Gigabit-Ethernet speeds.

802.1Q trunks support two types of frames: tagged and untagged.

* untagged frame
	* does not carry any VLAN identification information in it
	* this is a standard, unaltered Ethernet frame

VLAN membership for frame is determined by the switch's port configuration: if the port is configured in VLAN 1, the untagged frame belongs to VLAN 1 This VLAN is commonly called a *native* VLAN.

A tagged frame contains VLAN information, and only other 802.1Q-aware devices on the trunk will be able to process this frame.

One of the unique aspects of 802.1Q trunking is that you can have *both* tagged and untagged frames on a trunk connection

![[Pasted image 20250720121328.png]]

In this example, the white VLAN (PC-A, PC-B, PC-E and PC-F) uses tagged frames on the trunk between SwitchA and SwitchB. Any other device that is connected on this trunk line would need to have 802.1Q trunking enabled to see the tag inside the frame to determine the source VLAN on the frame. In this network, a third device is connected to the trunk connection: PC-G.

This example assumes that a hub connects the two switches and the PC together.

PC-G has a normal Ethernet NIC and obisously wouldn't understand the tagging and would drop these frames. However, this presents a problem: PC-G belongs to the dark VLAN, where PC-C an PC-D are also members. Therefore, in order for frames to be forwarded among these three members, the trunk must also support untagged frames so that PC-G can process them.

To set this up, you would configure the switch-to-switch connection as an 802.1Q trunk but set the native VLAN as the dark one, so that frames from this VLAN would go untagged across it and would allow PC-G to process them.

One restriction placed on an 802.1Q trunk configuration is that it must be the *same* on both sides. In other words, if the dark VLAN is the native VLAN on the switch, the switch at the other end must have the native VLAN set to the dark VLAN. Likewise, if the white VLAN is having its frames tagged on one switch, the other switch must also be tagging the white VLAN frames with 802.1Q information.

With the 802.1Q tagging method, the original Ethernet frame is modified. A 4-byte *tag* field is inserted into the header of the original Ethernet frame, and the original frame's FCS (checksum) is recomputed on the basis of this change. The first 2 bytes of the tag are the protocol identifier.
For instance, an Ethernet type frame has a protocol identifier value of 0x8100, indicating that this is an Ethernet tagged frame.
The next 3 bits are used to prioritize the frame, which is defined in the IEEE 802.1p standard.
The fourth bit indicates if this is an encapsulated Token Ring frame (Cisco no longer sells Token Ring products)
last 12 bits are used for the VLAN identifier (number).

![[Pasted image 20250720123151.png]]

the process that occurs when tagging an Ethernet frame by inserting the 802.1Q field into the Ethernet frame header.

step 1 is normal, untagged Ethernet fame.
step 2 inserts the tag and recomputes a new FCS(checksum) value. the tag is inserted directly after the source and destination MAC address in the Ethernet header.

> 802.1Q is a standardized trunking method that inserts a 4-byte field into the original Ethernet frame and recalculates the FCS. Newer Cisco switches support only 802.1Q trunking and not the older ISL protocol. The native VLAN contains untagged frames, even on trunk connections.

One advantage of using this tagging mechanism is that, since you are adding only 4 bytes, your frame size will not exceed 1518 bytes, and thus you could actually forward 802.1Q frames through the access port connections of switches, since these switches would forward the frame as a normal Ethernet frame.

### Configuring Trunks

Configuring a port as a trunk port enables it to carry VLAN traffic from one switch to another across the trunk port.

#### Dynamic Trunking Protocol

Cisco's proprietary *Dynamic Trunking Protocol(DTP)* is used to form and verify a trunk connection dynamically between two Cisco switches using a trunk connection.

| DTP Mode     | Generate DTP Messages | Default Frame Tagging |
| ------------ | --------------------- | --------------------- |
| On or trunk  | Yes                   | Yes                   |
| Desirable    | Yes                   | No                    |
| Auto         | No                    | No                    |
| No-negotiate | No                    | Yes                   |
| Off          | No                    | No                    |

If the trunk mode is set to **on** or **trunk** for an interface, it causes the interface to generate DTP messages on the interface and to tag frames on the interface, based on the trunk type (802.1Q).

When set to **on**, the trunk interface always assumes the connection is a trunk, even if the remote end does not support trunking. Most newer Cisco switches use the term **trunk** instead of **on**

If the trunk mode is set to **desirable**, the interface will generate DTP messages on the interface, but it will make the assumption that the other side is not trunk-capable and will wait for a DTP reply message from the remote side. In this state, the interface starts as an access port connection. If the remote side sends a DTP message, and this message indicates that trunking is compatible between the two switches, a trunk will be formed and the switch will start tagging frames on the interface. If the other side does not support trunking, the interface will remain as an access port connection.

If the trunk mode is set to **auto**, the interface passively listens for DTP messages from the remote side and leaves the interface as an access port connection. If the interface receives a DTP message, and the message matches trunking capabilities of the interface, then the interface will change from an access port connection to a trunk connection and start tagging frames. This is the default DTP mode for a Cisco switch interface that is trunk-capable.

If an interface is set to **no-negotiate**, the interface is set as a trunk connection and will automatically tag frames with VLAN information; however, the interface will not generate DTP messages: DTP is disabled. This mode is typically used when connecting trunk connections to non-Cisco devices that don't understand Cisco's proprietary trunking protocol and thus won't understand the contents of these messages.

If an interface is set to **off**, the interface is configured as an access port. No DTP messages are generated in this mode, nor are the frames tagged.

| Your Switch  | Remote Switch       |
| ------------ | ------------------- |
| On           | On, desirable, auto |
| Desirable    | On, desirable, auto |
| Auto         | On, desriable       |
| No-negotiate | No-negotiate        |

If you use the **no-negotiate** mode trunking is formed but DTP is not used, whereas if you use on, desirable, or auto, DTP is used. One advantage that DTP has over no-negotiate is that DTP checks for the trunk's characteristics: if they don't match on the two sides (for instance, as to the type of trunk or a mismatch with the native VLAN), then the trunk will not come up and the interfaces will remain as an access port connection. With no-negotiate, if the trunking characteristics don't match on the two sides, the trunk connection will probably fail.

#### Switch Trunk Configuration

```

IOU1#config t
Enter configuration commands, one per line.  End with CNTL/Z.

### navigating to the interface
IOU1(config)#interface E0/0

### enabling trunking
IOU1(config-if)#switchport trunk encapsulation dot1q
IOU1(config-if)#switchport mode ?
  access        Set trunking mode to ACCESS unconditionally
  dot1q-tunnel  set trunking mode to TUNNEL unconditionally
  private-vlan  Set private-vlan mode
  trunk         Set trunking mode to TRUNK unconditionally

IOU1(config-if)#switchport mode trunk
IOU1(config-if)#

### verification
IOU1#show interface E0/0 switchport
Name: Et0/0
Switchport: Enabled
Administrative Mode: trunk
Operational Mode: trunk
Administrative Trunking Encapsulation: dot1q
Operational Trunking Encapsulation: dot1q
Negotiation of Trunking: On
Access Mode VLAN: 1 (default)
Trunking Native Mode VLAN: 1 (default)
Administrative Native VLAN tagging: enabled
Voice VLAN: none
Administrative private-vlan host-association: none
Administrative private-vlan mapping: none
Administrative private-vlan trunk native VLAN: none
Administrative private-vlan trunk Native VLAN tagging: enabled
Administrative private-vlan trunk encapsulation: dot1q
Administrative private-vlan trunk normal VLANs: none
Administrative private-vlan trunk associations: none
Administrative private-vlan trunk mappings: none
Operational private-vlan: none
Trunking VLANs Enabled: ALL
Pruning VLANs Enabled: 2-1001
Capture Mode Disabled
Capture VLANs Allowed: ALL

Appliance trust: none

### verification 02
IOU1#show interface E0/0 trunk

Port        Mode             Encapsulation  Status        Native vlan
Et0/0       on               802.1q         trunking      1

Port        Vlans allowed on trunk
Et0/0       1-4094

Port        Vlans allowed and active in management domain
Et0/0       1

Port        Vlans in spanning tree forwarding state and not pruned
Et0/0       1
```

### Creating VLANs

* The number of VLANs you can create is dependent on the switch model and IOS software
* Some VLANs are preconfigured on every switch, including VLAN 1 and 1002-1005 (1002-1005 are used in Token Ring and FDDI networks only). These VLANs cannot be deleted
* To add or delete VLANs, your switch must use either VTP server or transparent mode.
* VLAN names can be changed, but VLAN numbers can't; you must delete a VLAN and re-add it in order to renumber it.
* All interfaces, by default, belong to VLAN 1.
* CDP, DTP, and VTP advertisements are sent in the native VLAN, which is VLAN 1, by default.
* Before you delete a VLAN, reassign any ports from the current VLAN to another; if you don't, any ports from the deleted VLAN will be inoperable.
* Unknown destination MAC addresses are flooded only in the VLAN in which the source MAC address resides.

```
switch(config)# vlan VLAN_#
switch(config-vlan)# name VLAN_NAME
```

When you execute the `vlan` command, you have access to the VLAN subconfiguration mode, where you can enter your configuration parameters for the VLAN, such as its name. Use the `no` parameter in front of the `vlan` command to delete the VLAN at any time

Once you have created a VLAN, you need to assign the interfaces you want be part of that VLAN. To assign a port to a VLAN, navigate to the port, ensure that it is running as an access port, and then assign it to a VLAN:

```
### navigate to interface
switch(config)#interface type0/port_#

### configure the port as an access port
switch(config-if)#switchport mode access

### assigns the port to a VLAN
switch(config-if)#switchport access vlan VLAN_#

### specify the VLAN to be used for VoIP devices connected to the port
### this configuration enables you to connect a VoIP phone to the port and ehn have a computer connected to the phone
### optional
switch(config-if)#switchport voice vlan VLAN_#
```

```
### verify
IOU1#show vlan

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Et0/1, Et0/2, Et0/3, Et1/0
                                                Et1/1, Et1/2, Et1/3, Et2/0
                                                Et2/1, Et2/2, Et2/3, Et3/0
                                                Et3/1, Et3/2, Et3/3
1002 fddi-default                     act/unsup
1003 token-ring-default               act/unsup
1004 fddinet-default                  act/unsup
1005 trnet-default                    act/unsup

VLAN Type  SAID       MTU   Parent RingNo BridgeNo Stp  BrdgMode Trans1 Trans2
---- ----- ---------- ----- ------ ------ -------- ---- -------- ------ ------
1    enet  100001     1500  -      -      -        -    -        0      0
1002 fddi  101002     1500  -      -      -        -    -        0      0
1003 tr    101003     1500  -      -      -        -    -        0      0
1004 fdnet 101004     1500  -      -      -        ieee -        0      0
1005 trnet 101005     1500  -      -      -        ibm  -        0      0

Primary Secondary Type              Ports
------- --------- ----------------- ------------------------------------------
```



### Basic Troubleshooting of VLANs and Trunks

1. Check the status of your interface to determine whether it is a physical layer problem.
2. Check your switches' and routers' configuration to make sure nothing was added or changed.
3. Verify that your trunks are operational.
4. Verify that your VLANs are configured correctly and that the STP is functioning correctly.

#### Performance Problems

If you are experiencing slow performance or intermittent connection problems, you should first check the statstics on the interfaces of your switch with the `show interfaces` command.

A few things can cause these problems. The most common is a mismatch in either the duplexing or the speed on a connection. Examine the settings on both sides of the connection. Also make sure that you are using the correct cabling type: straight for DTE-to-DCE connection and crossover for a DTE-to-DTE or DCE-to-DCE connection. And make sure that the cable does not exceed the maximum legal limit. Also, make sure that the connected IC is not experiencing a hardware problem or failure.

#### Local Connection Problems

If you are attempting to access the console port of a switch or router, and all you see is garbage in your terminal session, this could indicate an incorrect terminal setting. Usually the culprit is an incorrect baud rate.

Some devices allow you to perform an operating system upgrade via the console port, and an administrator might change it to the highest possible value but forgot to change it back to 9600 bps. If you suspect this, keep on changing your baud rate until you find the right speed.

If you are having problems accessing devices in the switched network, you can look at a few options. First, is the device you are trying to reach in the same VLAN? If so, make sure that you are using the correct IP addressing scheme in the VLAN and that two devices trying to share information have their ports in the same VLAN. If the two devices are Cisco devices, you can use CDP to elicit some of this information, for instance the IP address, by using `show cdp` command. Is the switch learning about the devices in your network? You may want to examine your CAM tables and make sure that a port security violation is not causing your connectivity proble.

For VLAN information, use the `show` commands on your switches to check your VLAN configuration. Also check the VLAN configuration on each switch and make sure the VLANs are configured with the same parameters by using the `show vlan` command. If the port LED is solid amber, your problem could be that the port's VLAN was deleted and the port wasn't reassigned. Other problems can also cause the port LED to turn amber, such as STP placing the port in blocking state or port security disabling the port because of a security violation.
Actually, if you see that a lot of port LEDs are amber, a deleted VLAN is probably the problem. Use the `show interface switchport` command to determine whether a deleted VLAN is the problem

#### Inter-VLAN Connection Problems

If you are having problems reaching devices in other VLANs, make sure that, first, you can ping the default gateway (router) that is your exit point from the VLAN. A common misconfiguration on a user's PC is a misconfigured default gateway. If you can't ping the default gateway, then go back to the proceding section and check local VLAN connectivity issues. If you can ping the gateway, check the router's configuration and its interface. Also make sure that the router has a route to the destination VLAN (`show ip route`). If you do have a route to the destination, make sure the destination VLAN is configured correctly and that the default gateway in that VLAN can reach the destination device.

### Exercise 9-6: Configuring VLANs

![[Pasted image 20250720162826.png]]

ComputerA is connected to port 5 of VAN-SW1
ComputerB is connected to port 15 of VAN-SW1
ComputerC is connected to port 5 of VAN-SW2
ComputerD is connected to port 15 of VAN-SW2

*local simulator settings*
(Switch1 E0/0 -> Switch2 E0/0, Swith1 E0/3 -> Switch2 E0/3)
(Switch1 E1/0 -> PC1, Switch1 E1/1 -> PC2)
(Switch2 E1/0 -> PC3, Switch2 E1/1 -> PC3)

Switch1 -> 2003
Switch2 -> 2004
PC1 -> 2001
PC2 -> 2005
PC3 -> 2007
PC4 -> 2009

*change hostname*

```
### IOU1
IOU1#config t
Enter configuration commands, one per line.  End with CNTL/Z.
IOU1(config)#hostname VAN-SW1
VAN-SW1(config)#

### IOU2
IOU2#config t
Enter configuration commands, one per line.  End with CNTL/Z.
IOU2(config)#hostname VAN-SW2
VAN-SW2(config)#
```

1. On VAN-SW1, create MKT VLAN with VLAN ID 2, and a SALES VLAN with VLAN ID 3

```
VAN-SW1#config t
Enter configuration commands, one per line.  End with CNTL/Z.
VAN-SW1(config)#vlan 2
VAN-SW1(config-vlan)#name MKT
VAN-SW1(config-vlan)#exit
VAN-SW1(config)#vlan 3
VAN-SW1(config-vlan)#name SALES
VAN-SW1(config-vlan)#exit
VAN-SW1(config)#

### verify
VAN-SW1#show vlan

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Et0/1, Et0/2, Et1/0, Et1/1
                                                Et1/2, Et1/3, Et2/0, Et2/1
                                                Et2/2, Et2/3, Et3/0, Et3/1
                                                Et3/2, Et3/3
2    MKT                              active
3    SALES                            active
1002 fddi-default                     act/unsup
1003 token-ring-default               act/unsup
1004 fddinet-default                  act/unsup
1005 trnet-default                    act/unsup

VLAN Type  SAID       MTU   Parent RingNo BridgeNo Stp  BrdgMode Trans1 Trans2
---- ----- ---------- ----- ------ ------ -------- ---- -------- ------ ------
1    enet  100001     1500  -      -      -        -    -        0      0
2    enet  100002     1500  -      -      -        -    -        0      0
3    enet  100003     1500  -      -      -        -    -        0      0
1002 fddi  101002     1500  -      -      -        -    -        0      0
1003 tr    101003     1500  -      -      -        -    -        0      0
1004 fdnet 101004     1500  -      -      -        ieee -        0      0
1005 trnet 101005     1500  -      -      -        ibm  -        0      0

Primary Secondary Type              Ports
------- --------- ----------------- ------------------------------------------

VAN-SW1#
*Jul 20 07:41:15.885: %SYS-5-CONFIG_I: Configured from console by console
VAN-SW1#

```

2. Place ComputerA into the MKT VLAN

```
VAN-SW1#config t
Enter configuration commands, one per line.  End with CNTL/Z.
VAN-SW1(config)#interface E1/0
VAN-SW1(config-if)#switchport mode access
VAN-SW1(config-if)#switchport access vlan 2
VAN-SW1(config-if)#exit

### verify
VAN-SW1#show vlan

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Et0/1, Et0/2, Et1/1, Et1/2
                                                Et1/3, Et2/0, Et2/1, Et2/2
                                                Et2/3, Et3/0, Et3/1, Et3/2
                                                Et3/3
2    MKT                              active    Et1/0
3    SALES                            active
1002 fddi-default                     act/unsup
1003 token-ring-default               act/unsup
1004 fddinet-default                  act/unsup
1005 trnet-default                    act/unsup

VLAN Type  SAID       MTU   Parent RingNo BridgeNo Stp  BrdgMode Trans1 Trans2
---- ----- ---------- ----- ------ ------ -------- ---- -------- ------ ------
1    enet  100001     1500  -      -      -        -    -        0      0
2    enet  100002     1500  -      -      -        -    -        0      0
3    enet  100003     1500  -      -      -        -    -        0      0
1002 fddi  101002     1500  -      -      -        -    -        0      0
1003 tr    101003     1500  -      -      -        -    -        0      0
1004 fdnet 101004     1500  -      -      -        ieee -        0      0
1005 trnet 101005     1500  -      -      -        ibm  -        0      0

Primary Secondary Type              Ports
------- --------- ----------------- ------------------------------------------

VAN-SW1#
```

3. Place ComputerB into SALES VLAN

```

VAN-SW1#config t
Enter configuration commands, one per line.  End with CNTL/Z.
VAN-SW1(config)#interface E1/1
VAN-SW1(config-if)#switchport mode access
VAN-SW1(config-if)#switchport access vlan 3

### verify
VAN-SW1(config-if)#do show vlan

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Et0/1, Et0/2, Et1/2, Et1/3
                                                Et2/0, Et2/1, Et2/2, Et2/3
                                                Et3/0, Et3/1, Et3/2, Et3/3
2    MKT                              active    Et1/0
3    SALES                            active    Et1/1
1002 fddi-default                     act/unsup
1003 token-ring-default               act/unsup
1004 fddinet-default                  act/unsup
1005 trnet-default                    act/unsup

VLAN Type  SAID       MTU   Parent RingNo BridgeNo Stp  BrdgMode Trans1 Trans2
---- ----- ---------- ----- ------ ------ -------- ---- -------- ------ ------
1    enet  100001     1500  -      -      -        -    -        0      0
2    enet  100002     1500  -      -      -        -    -        0      0
3    enet  100003     1500  -      -      -        -    -        0      0
1002 fddi  101002     1500  -      -      -        -    -        0      0
1003 tr    101003     1500  -      -      -        -    -        0      0
1004 fdnet 101004     1500  -      -      -        ieee -        0      0
1005 trnet 101005     1500  -      -      -        ibm  -        0      0

Primary Secondary Type              Ports
------- --------- ----------------- ------------------------------------------

VAN-SW1(config-if)#

```

4. VAN-SW2

```
### create vlan
VAN-SW2#config t
Enter configuration commands, one per line.  End with CNTL/Z.
VAN-SW2(config)#vlan 2
VAN-SW2(config-vlan)#name MKT
VAN-SW2(config-vlan)#exit
VAN-SW2(config)#vlan 3
VAN-SW2(config-vlan)#name SALES
VAN-SW2(config-vlan)#exit

### verify
VAN-SW2(config)#do show vlan

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Et0/1, Et0/2, Et1/0, Et1/1
                                                Et1/2, Et1/3, Et2/0, Et2/1
                                                Et2/2, Et2/3, Et3/0, Et3/1
                                                Et3/2, Et3/3
2    MKT                              active
3    SALES                            active
1002 fddi-default                     act/unsup
1003 token-ring-default               act/unsup
1004 fddinet-default                  act/unsup
1005 trnet-default                    act/unsup

VLAN Type  SAID       MTU   Parent RingNo BridgeNo Stp  BrdgMode Trans1 Trans2
---- ----- ---------- ----- ------ ------ -------- ---- -------- ------ ------
1    enet  100001     1500  -      -      -        -    -        0      0
2    enet  100002     1500  -      -      -        -    -        0      0
3    enet  100003     1500  -      -      -        -    -        0      0
1002 fddi  101002     1500  -      -      -        -    -        0      0
1003 tr    101003     1500  -      -      -        -    -        0      0
1004 fdnet 101004     1500  -      -      -        ieee -        0      0
1005 trnet 101005     1500  -      -      -        ibm  -        0      0

Primary Secondary Type              Ports
------- --------- ----------------- ------------------------------------------

VAN-SW2(config)#

```

```
### Computer C into MKT VLAN
VAN-SW2(config)#interface E1/0
VAN-SW2(config-if)#switchport mode access
VAN-SW2(config-if)#switchport access vlan 2
VAN-SW2(config-if)#exit

### Computer D into SALES VLAN
VAN-SW2(config)#interface E1/1
VAN-SW2(config-if)#switchport mode access
VAN-SW2(config-if)#switchport access vlan 3

### verify
VAN-SW2(config-if)#do show vlan

VLAN Name                             Status    Ports
---- -------------------------------- --------- -------------------------------
1    default                          active    Et0/1, Et0/2, Et1/2, Et1/3
                                                Et2/0, Et2/1, Et2/2, Et2/3
                                                Et3/0, Et3/1, Et3/2, Et3/3
2    MKT                              active    Et1/0
3    SALES                            active    Et1/1
1002 fddi-default                     act/unsup
1003 token-ring-default               act/unsup
1004 fddinet-default                  act/unsup
1005 trnet-default                    act/unsup

VLAN Type  SAID       MTU   Parent RingNo BridgeNo Stp  BrdgMode Trans1 Trans2
---- ----- ---------- ----- ------ ------ -------- ---- -------- ------ ------
1    enet  100001     1500  -      -      -        -    -        0      0
2    enet  100002     1500  -      -      -        -    -        0      0
3    enet  100003     1500  -      -      -        -    -        0      0
1002 fddi  101002     1500  -      -      -        -    -        0      0
1003 tr    101003     1500  -      -      -        -    -        0      0
1004 fdnet 101004     1500  -      -      -        ieee -        0      0
1005 trnet 101005     1500  -      -      -        ibm  -        0      0

Primary Secondary Type              Ports
------- --------- ----------------- ------------------------------------------

VAN-SW2(config-if)#

```

5. On VAN-SW1, configure port 1 and port 24 as a trunk port (E0/0, E0/3)

```
VAN-SW1#config t
Enter configuration commands, one per line.  End with CNTL/Z.

### E0/0 trunk
VAN-SW1(config)#interface E0/0
VAN-SW1(config-if)#switchport trunk encapsulation dot1q
VAN-SW1(config-if)#switchport mode trunk
VAN-SW1(config-if)#exit

### E0/3 trunk
VAN-SW1(config)#interface E0/3
VAN-SW1(config-if)#switchport trunk encap dot1q
VAN-SW1(config-if)#switchport mode trunk
VAN-SW1(config-if)#exit

### verify
VAN-SW1(config)#do show interfaces trunk

Port        Mode             Encapsulation  Status        Native vlan
Et0/0       on               802.1q         trunking      1
Et0/3       on               802.1q         trunking      1

Port        Vlans allowed on trunk
Et0/0       1-4094
Et0/3       1-4094

Port        Vlans allowed and active in management domain
Et0/0       1-3
Et0/3       1-3

Port        Vlans in spanning tree forwarding state and not pruned
Et0/0       1-3
Et0/3       none
VAN-SW1(config)#

```
