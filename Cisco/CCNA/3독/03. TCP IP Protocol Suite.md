
## The TCP/IP Model

![[Pasted image 20251125051715.png]]

### Application Layer

The application layer is at the top of the TCP/IP model and corresponds to the application, presentation, and session layers of the OSI model.

It is responsible for making network requests (sending computer) or serving request (receving computer).

**Popular application layer protocols**

* **Hypertext Transfer Protocol (HTTP)**
	* Transfers HTML pages between the web server and the web browser
* **Hypertext Transfer Protocol Secure (HTTPS)**
	* Delivers encrypted HTML pages from the web server to the web browser
* **Simple Mail Transfer Protocol (SMTP)**
	* Sends e-mail
* **Post Office Protocol (POP)**
	* Reads or downloads e-mail
* **File Transfer Protocol (FTP)**
	* Lets you download files from a system on the network or the Internet
* **Domain Name System (DNS)**
	* Converts fully qualified domain names (FQDNs) to IP addresses
* **Remote Desktop Protocol (RDP)**
	* Helps you operate a system remotely

### Transport Layer

Responsible for both connection-oritented communication and connectionless communication. The two transport layer protocols in TCP/IP are the Transmission Control Protocol (TCP) and the User Datagram Protocol (UDP).

If connection-oriented communication is required, TCP is used as the transport layer protocol, but if connectionless communication is required, UDP is used.

### Internet Layer

The Internet layer corresponds to the network layer of the OSI mode. It is responsible for logical addressing, routing, and converting the logical address to the physical address (MAC).

**Protocol examples**

* **Internet Protocol (IP)**
	* Handles all logical addressing (IP addresses) and routing functionality
* **Address Resolution Protocol (ARP)**
	* Converts the logical address to a physical address
* **Internet Control Message Protocol (ICMP)**
	* Reports the status and any errors in the TCP/IP protocol suite

### Network Access Layer

The network access layer is sometimes referred to as the network interface layer or the link layer.
The network access layer corresponds to the data link and physical layers of the OSI model.

---

## Transport Layer Protocols

### Transmission Control Protocol (TCP)

TCP is reponsible for providing connection-oriented communication and for ensuring delivery of the data (known as realiable delivery).

Connection oriented communication involves first establishing a connection between two systems and then ensuring that data sent across the connection reaches the destination.
This transport has more overhead than a connectionless protocol because of the construction of the session and the monitoring and retransmittion of any data across that session.

TCP ensures that data is delivered by using sequence numbers and acknowlegement numbers.
A *sequence number* is a number assigned to each piece of data that is sent. After a system receives a piece of data, it acknowledges that it has received the data by sending an acknowledgement message back to the sender, with the original sequence number being the *acknowledgement number* of the reply message.

#### TCP Three-Way Handshake

Before a system can communicate over TCP, it must first establish a connection to the remote system. It does this through the TCP three-way handshake

![[Pasted image 20251125053603.png]]

1. **SYN**
	* The sending system sends a SYN message to the receiving system.
	* The SYN message contains the *initial sequence number (ISN)*, which is the first sequence number to be used.
2. **SYN/ACK**
	* This phase acknowledges the first message, but at the same time indicates its initial sequence number.
3. **ACK**
	* Acknowledges that the packet sent in the second phase has been received.

#### Disconnecting from a TCP Session

![[Pasted image 20251125053848.png]]

If Computer A wants to disconnect from a TCP session, it must send a FIN flag to Computer B to signal that it wants to end the converstaion.
When Computer B receives the FIN message, it replies with an acknowledgement and then sends its own FIN message back to Computer A.
As a final step to this process, Computer A must acknowledge that it received the FIN message from Computer B.

Also you can "hang up" by sending a TCP message with the RST (reset) flag set.

#### TCP Ports

**Popular TCP Ports**

| Port | Service     | Desc                                                   |
| ---- | ----------- | ------------------------------------------------------ |
| 20   | FTP Data    | Used by FTP to send dat to a client                    |
| 21   | FTP Control | Used by FTP commands sent to the server                |
| 22   | SSH         |                                                        |
| 23   | Telent      |                                                        |
| 25   | SMTP        | Used to send e-mail                                    |
| 53   | DNS         | Used for DNS zone transfers                            |
| 80   | HTTP        |                                                        |
| 110  | POP3        | Used by POP3 to read e-mail                            |
| 143  | IMAP        | Used by IMAP, a newer Internet protocol to read e-mail |
| 443  | HTTPS       |                                                        |
| 3389 | RDP         | Remote Desktop Protocol                                |

Both TCP and UDP support up to 65,536 port numbers that range from 0 to 65,535. The port numbers are divided into three different categories:

* **Well-known**
	* range from 0 to 1023
	* Assigned by the Internet Assigned Number Authority (IANA) to application servers commonly used on the Internet
* **Registered**
	* range form 1024 to 49,151
	* Assigned by IANA for proprietary application
* **Dynamically assigned**
	* range from 49,151 to 65,535
	* Dynamically assigned by the system, typically used by client software such as web browser, FTP client, or telnet client

#### TCP Flags

**Common TCP Flags**

* **SYN**
	* SYN flag is assigned to any packets that are part of the SYN phases of the three-way handshake
* **ACK**
	* Acknowleges that a previous packet has been received
* **PSH**
	* Push flag is designed to force data on an application
* **URG**
	* The urgent flag specifies that a packet is urgent
* **FIN**
	* The finish flag sepcifies that you would like to finalize, or end the connection.
* **RST**
	* The reset flag is used to end a TCP conversation impolietly.

#### TCP Header

![[Pasted image 20251125055254.png]]

| Field                  | size     | desc                                                                                                 |
| ---------------------- | -------- | ---------------------------------------------------------------------------------------------------- |
| Source Port            | 16 bit   | identifies the port number of the sending system                                                     |
| Destination port       | 16 bit   | Identifies the port number the packet is destined for.                                               |
| Sequence number        | 32 bit   | Identifies the sequence number of the packet                                                         |
| Acknowledgement number | 32 bit   | Identifies the packet that this packet is acknowledging                                              |
| Offset                 | 4 bit    | Indicates where the data begins                                                                      |
| Reserved               | 6 bit    | Always set to 0 and was designed for future use                                                      |
| Flags                  | 6 bit    | Where the TCP flags are stored.                                                                      |
| Window size            | 16 bit   | Deterimes the amount of information can be sent before an ACK is expected.                           |
| Checksum               | 16 bit   | Used to verify the integrity of the TCP header                                                       |
| Urgent Pointer         | 16 bit   | Used only if the URG flag is set and is a reference to the last piece of information that was urgent |
| Options                | variable | Specifies any additional settings that may be needed in the TCP header                               |

### User Datagram Protocol (UDP)

UDP is used for connectionless communication (unreliable), which means that data is sent to the destination and no effort is made to track the progress of the packet or determine whether it has reached the destination.

#### UDP Ports

**Popular UDP Ports**

| port     | service | desc                                                             |
| -------- | ------- | ---------------------------------------------------------------- |
| 53       | DNS     | Used for DNS queries                                             |
| 67, 68   | DHCP    | 67 is used by the DHCP service and 68 is used by client requests |
| 69       | TFTP    |                                                                  |
| 137, 138 | NetBIOS |                                                                  |
| 161      | SNMP    |                                                                  |

#### UDP Header

![[Pasted image 20251125062906.png]]

| Field            | size | desc                                                                     |
| ---------------- | ---- | ------------------------------------------------------------------------ |
| Source port      | 16   | Indicates the port used by the sending application on the sending system |
| Destination port | 16   | Indicates the port used by the application on the destination system     |
| Length           | 16   | Speicifies the size of the UDP header in bytes                           |
| Checksum         | 16   | Verify the integrity of the UDP header                                   |

---

## Internet Layer Protocols

After a transport protocol has been selected, which is based on whether the communication should be connection oriented or connectionless, the information is passed to the Internet layer to determine who is responsible for its delivery.

### Internet Protocol (IP)

IP provides packet delivery for protocols in higher layers of the model.

It is a conectionless delivery system that makes a "best-effort" attempt to deliver the packets to the correct destination.

IP is also responsible for the logical addressing and routing of TCP/IP and, therefore, is considered a layer 3 protocol of the OSI model. The IP on the router is reponsible for decrementing the TTL (time of live) of the packet to prevent it from running in a "network loop".
Once the TTL of the packet is decremented to 0, the router removes the packet from the network and sends a status message to the sender (using ICMP).

#### IP Header

![[Pasted image 20251125063405.png]]

| Field           | size     | desc                                                                                                                                                                                    |
| --------------- | -------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Version         | 4        | Identifies the version of IP being used (4 or 6)                                                                                                                                        |
| Header length   | 4        | Indicates the size of the IP header                                                                                                                                                     |
| Type of Service | 8        | Indicates how the packet should be handled by the system.                                                                                                                               |
| Total length    | 16       | Indicates the size of the IP packet                                                                                                                                                     |
| Identification  | 16       | Because networks can handle only packets of a specific maximum size (MTU), the system may break the data being sent into multiple fragment. This field uniquely identifies the fragment |
| IP Flags        | 3        | How fragments are going to be delat with, More Fragments (MF) flag indicates more fragments are to come. Don't Fragment (DF) specifies not to fragment the packet                       |
| Fragment Offset | 13       | Specifies the order in which the fragments are to be put back together when the packet is assembled.                                                                                    |
| TTL             | 8        | Specifies when the packet to expire.                                                                                                                                                    |
| Protocol        | 8        | Specifies what layer 4 protocol (TCP or UDP) the packet should use                                                                                                                      |
| Header checksum | 16       | Verifies the integrity of the IP hader                                                                                                                                                  |
| Source address  | 32       | Represents the IP address of the system the packet is destined for                                                                                                                      |
| IP Options      | variable | Specify any other settings in the IP header                                                                                                                                             |

### Internet Control Message Protocol (ICMP)

ICMP enables systems on a TCP/IP network to share status and error information.
ICMP messages are encapsulated within IP datagrams so that they can be routed throughout a network. Two programs that use ICMP messages are `ping` and `tracert`.

#### ICMP Types and Codes

ICMP does not use port numbers, but instead uses ICMP types and codes to identify the different types of messages.

**Common ICMP Types and Codes**

| Type                 | Code | Desc                             |
| -------------------- | ---- | -------------------------------- |
| 0 - Echo Reply       | 0    | Echo reply message               |
| 3 - Dest Unreachable | 0    | Destination network              |
|                      | 1    | Destination host unreachable     |
|                      | 2    | Destination protocol unreachable |
|                      | 3    | Destination port unreachable     |
| 8 - Echo request     | 0    | Echo request message             |

#### ICMP Header

![[Pasted image 20251125064220.png]]

| Field    | size | desc                                            |
| -------- | ---- | ----------------------------------------------- |
| Type     | 8    | Indicates the ICMP type being used              |
| Code     | 8    | Indicates the ICMP code being used              |
| Checksum | 16   | Used to verify the integrity of the ICMP header |
| Other    |      | Any data within the ICMP header.                |

Note that Internet Group Management Protocol (IGMP) is another Internet-layer protocol and is used for multicast applications.

### Address Resolution Protocol (ARP)

ARP provides IP address-to-physical address resolutioin on TCP/IP network. To accomplish this feature, ARP sends out a broadcast message with an ARP request packet that contains the IP address of the system it is trying to find. All systems on the local network see the message, and the system that owns the IP address for which ARP is looking replies by sending its physical address to the originating system in an ARP reply packet.
The physical/IP address combo is then stored in the ARP cache of the origniating system for future use.

#### Single-Segment ARP Example

![[Pasted image 20251125064615.png]]

In this example, PC-A wants to send information directly to PC-B. PC-A knows PC-B's IP address; however, it dosen't know PC-B's MAC address.
To resolve the IP address to a MAC address, PC-A generates an ARP request message. In the ARP request mesasge, the source IP address is 10.1.1.1 and the destination ip address is 255.255.255.255 (the broadcast address). PC-A includes PC-B's IP address in the data field of the ARP datagram. This is encapsulated into an Ethernet frame, with a source MAC address of 0000.0CCC.1111, and a destination MAC address of FF:FF:FF:FF:FF:FF (the local broadcast address) and is then placed on the Ethernet segment. Both PC-B and PC-C see this frame.
Both devices' NICs notice the data link layer broadcast address and assuem that this frame is for them, since the destination MAC address is a broadcast, so they strip off the Ethernet frame and pass the IP datagram with the ARP request up to the Internet layer.
PC-B notices that this is an ARP request and that this is its own IP address in the query, and it therefore responds directly back to PC-A with PC-B's MAC address. PC-C however, sees that this is not an ARP for its own MAC address and ignores the requested datagram braodcast.

> Both PC-B and PC-C will do is add PC-A's MAC address to their local ARP tables after they have recived the initial broadcast message.
> Also, a device can generate *gratuitous ARP*, an ARP reply that is generated without a corresponding ARP request. This is commonly used when a device may change its IP address or MAC address and wants to notify all other devices on the segment about the change so that the other devices have the correct information in their local ARP tables.

#### Two-Segment ARP Example

![[Pasted image 20251125070859.png]]

In this example, PC-A wants to connect PC-B using IP. The source IP address is 1.1.1.1 (PC-A), and the destination is 2.2.2.2 (PC-B).
Because the two devices are on different networks, a router is used to communicate between the networks. Therefore, if PC-A wants to send someting to PC-B, it has to be sent via intermediate router. However, this communication does not occur at the network layer using IP; instead, it occurs at the data link layer.

The first thing that PC-A will do is determine whether the destination IP address is on the local network or a remote network. In this example, it is determined that the destination is on a remote network, so PC-A will need to know the MAC address of the default gateway router in order to send the data to the router. If the router's MAC address isn't already in its local ARP cache, PC-A will generate an ARP request for the default gateway's MAC address. Then the router responds with the MAC address of its Ethernet interface connected to PC-A. Then PC-A creates an IP packet with the source and destination IP addresses and encapsulates this in an Ethernet frame, with the soruce MAC address of PC-A and the destination MAC address of the *rotuer*. PC-A then sends the Ethernet frame to the router.

1. (PC-A) determine whether the destination IP address is on the local or remote
2. (If destination IP address is in remote) (PC-A) need to know the MAC address of the default gateway router
3. (If PC-A dosen't know the router's MAC address) PC-A generate ARP request for the default gateway's MAC address
4. Rotuer responds with the MAC address of its Ehternet interface connected to PC-A
5. PC-A create an IP packet with source (PC-A) destination (PC-B) IP addresses and source MAC (PC-A) destination MAC (Router) addresses.
6. PC-A sends this Ethernet frame to the router.

When the router receives the Ethernet frame, the router compares the frame to the MAC address on its Ethernet interface, which it matches. The router strips off the Ethernet frame and makes a routing decision based on the destination address of 2.2.2.2. In this case the network is directely connected to the router's second interface.
If the router doesn't have PC-B's MAC address in its local ARP cache, the router ARPs for the MAC address of PC-B and receives the response. The router then encapsulates the original IP packet in a new Etherenet frame, placing its second interface's MAC address, which is sourcing the fram, in the source MAC address field and PC-B's MAC address in the destination field.
When PC-B receives this, it konws the frame is for itself and that PC-A originated the IP packet that's encapsulated based on the soruce IP address in the IP header.

The original IP addressing in the packet was not altered by the router, but two Ethernet frames are used to get the IP packet to the destination.
Also, each device will keep the MAC addresses in a local ARP cahce, so the next time PC-A needs to send someting to PC-B the devices will not have to ARP other intermediate devices again.

### Ex 3-1: Identifying TCP/IP Protocols

![[Pasted image 20251125072833.png]]

| Protocol | Desc                                                 |
| -------- | ---------------------------------------------------- |
| TCP      | Responsible for reliable delivery                    |
| SMTP     | Internet protocol to send e-mail                     |
| ICMP     | Responsible for error and status reporting           |
| ARP      | Converts the logical address to the physical address |
| UDP      | Unreliable delivery                                  |
| HTTPS    | Secure transmission of web traffic                   |
| FTP      | Application layer protocol used to download files    |
| IP       | Responsible for logical addressing and routing       |

---

## Review

* TCP/IP is suite of protocols. Each protocol in the suite has its own set of responsibilities
* TCP is used for connection-oriented, or reliable, communication.
* UDP is used for connectionless, or unreliable, communication.
* The Internet Protocol (IP) handles logical addressing and routing.
* ARP is used to convert logical addresses to physical addresses
* ICMP is the error-reporting or status-reporting protocol in the TCP/IP protocol suite.

---

## Questions

1.  Which layer of the OSI model does IP run at?

A. Layer 2
**B. Layer 3**
C. Layer 4
D. Layer 5

2.  Which of the following protocols are layer 4 protocols of the OSI model? (Select all that apply.)

**A. TCP**
B. IP: 3
C. ARP : 3
**D. UDP**

3.  Which protocol is responsible for converting the IP address to a MAC address?

A. IP
B. TCP
**C. ARP**
D. ICMP

4.  Which protocol is responsible for connection-oriented communication?

**A. TCP**
B. IP
C. UDP
D. ICMP

5.  Which protocol is responsible for error reporting and status information?

**A. ICMP**
B. TCP
C. UDP
D. IP

6.  Which protocol is responsible for logical addressing and delivery of packets?

A. ICMP
B. TCP
**C. IP**
D. UDP

7.  What two items are used by TCP to guarantee delivery of data? (Choose two.)

A. Source port
**B. Acknowledgment numbers**
C. IP address
D. Destination port
**E. Sequence numbers**

8.  What field in the IP header identifies the system that the packet came from?

**A. Source IP address**
B. Protocol
C. Destination IP address
D. Source port : TCP or UDP header

9.  What field in the TCP header is used to specify the target application that the packet is for?

A. Source port
B. Destination IP address
C. Source IP address
**D. Destination port**

10. Using the following exhibit, write the protocols found on the left into the appropriate box on the right to identify the layer that the protocol runs at. On the real exam you would be expected to drag and drop the items into the appropriate box.

![[Pasted image 20251125073355.png]]

| Layer          | Protocol        |
| -------------- | --------------- |
| Application    | SMTP, FTP, HTTP |
| Transport      | TCP, UDP        |
| Internet       | ARP, ICMP, IP   |
| Network Access | Ethernet        |

11. Looking at the following exhibit, identify the phases of the TCP three-way handshake by writing the phase name into the boxes. On the real exam you would drag the phase found on the left to the appropriate box on the right.

![[Pasted image 20251125073421.png]]

1. SYN
2. SYN/ACK
3. ACK
