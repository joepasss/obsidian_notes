
The most popular protocol suite in use today is Transmission Control Protocol/Internet Protocol (TCP/IP).

## The TCP/IP Model

The TCP/IP model, is a four-layer model similar in concept to the seven-layer OSI Reference Model.

The four layers of the TCP/IP model map to the seven layers of the OSI version, but the TCP/IP models combines multiple layers of the OSI model.
![[Pasted image 20251004064519.png]]

Several protocols direct how computers connect and communicate using TCP/IP within the TCP/IP protocol suite, and each protocol runs on different layers of the TCP/IP Model.

### Application Layer

The application layer is at the top of the TCP/IP model and corresponds to the application, presentation, and session layers of the OSI model.
It is responsible for making network requrest (sending computer) or servicing requrest (receiving computer).
So, for example, when a user submits a requrest from a web browser, the web browser responsible for the submission of the request is running at the application layer.
When that web request reaches the web server, the web server running at the application layer accepts that request

Following are popular applcation layer protocols

* HTTP
* HTTPS
* SMTP
* POP
* FTP
* DNS
* RDP (Remote Desktop Protocol)

### Transport Layer

Transport layer is responsible for both connection-oriented communication (a session is established) and connectionless communication (a session is not established).

When the request comes down from the application layer, a transport protocol is chosen to handle it.
The two transport protocols in TCP/IP are the Transmission Control Protocol (TCP) and the User Datagram Protocol (UDP).
As data passes down the layers of the TCP/IP model, if connection-oriented communication is requiresd, TCP is used as the transport layer protocol, but if connectionless communication is required, UDP is used.

### Internet Layer

The Internet layer corresponds to the network layer of the OSI model.

It is responsible for a number of important network activities, such as logical addressing, routing, and converting the logical address to the physical Media Access Control (MAC) address.

Examples of protocols that run at this layer:

* **Internet Protocol (IP)*
	* Handles all logical addressing (IP addr) and routing
* **Address Resolution Protocol (ARP)**
	* Converts the logical address to physical address (IP -> MAC)
* **Internet Control Message Protocol (ICMP)**
	* Reports the status and any errors in the TCP/IP protocol suite

### Network Access Layer

The network access layer is sometimes referred to as the network interface layer or the link layer.
The network access layer corresponds to the data link and physical layers of the OSI model.

Examples of network access layer componenets are network architectures, physical addressing, cables, connectors, network media, and any other layer 2 and layer 1 network components.

---

## Transport Layer Protocols

Transport layer includes the TCP and UDP protocols.

### Transmission Control Protocol

TCP is responsible for providing connection-oriented communication and for ensuring delivery of the data (known as reliable delivery).

Connection-oriented communication involves first establishing a connection between two systems and then ensuring that data sent across the connection reaches the destination.

TCP will make sure that the data reaches its destination by retransmitting any data that is lost or corrupt.
TCP is used by applications that require a reliable transport, but this transport has more overhead than a connectionless protocol because of the construction of the session and the monitoring and retransmission of any data across that session.

Another factor to remember about TCP is that the protocol requires that the recipient acknowledge the successful receipt of data.
Of course, all the ACKs, generate additional traffic on the network, which reduces the amount of data that can be passed within on the network, which reduces the amount of data can be passed within a given time frame.
The extra overhead involved in the creation, monitoring, and ending of the TCP session is worth the certainty the TCP will ensure that the data will reach its destination.

TCP ensures that data is delivered by using sequence numbers and acknowlegement numbers.
A *sequence number* is a number assigned to each piece of data that is sent.
After a system receives a pice of data, it acknowledges that it has received the data by sending an acknowledgement messsage back to the sender, with the original sequence number being the *acknowledge number* of the reply message.

#### TCP Three-Way Handshake

Before a system can communicate over TCP, it must first establish a connection to the remote system.

**Three way handshake**
![[Pasted image 20251004073745.png]]

1. **SYN**
	* The sending system sends a SYN message to the receiving system.
	* Each packet sent is assigned a unique sequence number.
	* The SYN message contains *initial sequence number (ISN)*, which is the first sequence number to be used.
2. **SYN/ACK**
	* This phase acknowledges the first message, but at the same time indicates its initial sequence number.
3. **ACK**
	* The final phase is the acknowledgement message that acknowledges that the packet sent in the second phase has been received.

#### Disconnecting from a TCP Session

Just as TCP uses a three-way handshake process to create a connection between two systems that want to communicate, it also has a process for a participant to disconnect from the conversation.

**Terminating a TCP connection**
![[Pasted image 20251004074123.png]]

If Computer A wants to disconnect from a TCP session, it must first send a FIN flag to Computer B to signal that it wants to end the conversation.

When Computer B receives the FIN message, it replies with an acknowledgement and then sends its own FIN message back to Computer A.

As final step to this process, Computer A must acknowledge that it received the FIN message from Computer B.

There is also a way to end a conversation in an "impolite" manner. you can "hang up" by sending a TCP message with the RST (reset) flag set.

#### TCP Ports

When applications use TCP or UDP to communicate over the network, each application must be uniquely identified by a unique port number on the system.

A port is an address assigned to the application. When a client wants to communicate with one of these applications (also known as services), it must send the request to the appropriate port number on the system.

**port numbers used by popular services**

| Port | Service     | Desc                                            |
| ---- | ----------- | ----------------------------------------------- |
| 20   | FTP Data    | Used by FTP send data to a client               |
| 21   | FTP Control | Used by FTP commands sent to the server         |
| 22   | SSH         | Secure Shell                                    |
| 23   | Telent      |                                                 |
| 25   | SMTP        | send e-mail                                     |
| 53   | DNS         | Domain Name Service                             |
| 80   | HTTP        |                                                 |
| 110  | POP3        | read e-mail                                     |
| 143  | IMAP        | read e-mail                                     |
| 443  | HTTPS       | Secure HTTP                                     |
| 3389 | RDP         | Remote Desktop Protocol (manage windows system) |

Both TCP and UDP support up to 65,536 port numbers that range from 0 to 65535.
The port numbers are divided into three different categories:

* **Well-known**
	* These port numbers range from 0 to 1023 and are assigned by the Internet Assigned Number Authoriety (IANA) to application servers commonly used on the Internet
* **Registerd**
	* These port numbers range from 1024 to 49151 and are assigned by IANA for proprietary applications.
* **Dynamically assigned**
	* These port numbers range from 49152 to 65535 and are dynamically assigned by the system, typically used by client software (web browser, FTP client, telent client ...)

#### TCP Flags

TCP uses TCP flags to identify important types of packets.

**Common TCP Flags**
* **SYN**
	* SYN flag is assigned to any packets that are part of the SYN phases of the three-way handshake
* **ACK**
	* The acknowledgement flag acknowledges that a previous packet has been received.
* **PSH**
	* The push flag is designed to force data on an application
* **URG**
	* The urgent flag specifies that a packet is urgent.
* **FIN**
	* The finish flag specifies that you would like to finalize, or end, the connection.
	* This is how a TCP connection is ended the poilite way
* **RST**
	* The reset flag is used to end a TCP conversation impolitely.

#### TCP Header

Every packet that is sent using TCP has a TCP header assigned to it, which contains TCP-related information such as the source port, destination port, and the TCP flags.

![[Pasted image 20251004075450.png]]

* **Source Port**
	* This 16-bit field identifies the port number of the sending system
* **Destination port**
	* This 16-bit field identifies the port number the packet is destined for on the destination system.
* **Sequence Number**
	* This 32-bit field identifies the sequence number of the packet.
* **Acknowledgement Number**
	* This 32-bit field identifies the packet that this packet is acknowledging.
* **Offset**
	* This 4-bit field indicates where the data begins.
* **Reserved**
	* This 6-bit field where the TCP flags are stored.
	* There is 1-bit field for each of the TCP flags.
* **Window Size**
	* This 16-bit field determines the amount of information that can be sent before an acknowledgment is expected.
* **Checksum**
	* This 16-bit field is used to verify the integrity of the TCP header.
* **Urgent Pointer**
	* This 16-bit field is used only if the URG flag is set and is a reference to the last piece of information that was urgent.
* **Options**
	* This is a variable-length field that specifies any additional settings that may be needed in the TCP header.

### User Datagram Protocol

UDP is used by applications that are not concerned with ensuring that the data reaches the destination system.
UDP is used for connectionless communication (unreliable), which means that data is sent to the destination and no effort is made to track the progress of the packet or determine whether it has reached the destination.

#### UDP Ports

| Port        | Service | Desc                               |
| ----------- | ------- | ---------------------------------- |
| 53          | DNS     | DNS queries                        |
| 67 and 68   | DHCP    | 67: server, 68: client             |
| 69          | TFTP    | Trivial File Transfer Protocol     |
| 137 and 138 | NetBIOS |                                    |
| 161         | SNMP    | Simple Network Management Protocol |

#### UDP Header

Because UDP does not have to acknowledge the receipt a packet, the structure of the UDP header is much simpler than that of the TCP header.

For example, the UDP header does not need a sequence number or ACK number; it also does not need flags to indicate special packets such as SYN message, because there are no three-way handshake.

**UDP header**
![[Pasted image 20251004080615.png]]

* **Source Port**
	* 16-bit field
	* Indicates the port used by the sending application on the sending system
* **Destination Port**
	* 16-bit field
	* Indicates the port used by the application on the destination system.
* **Length**
	* 16-bit field
	* Size of the UDP header in bytes
* **Checksum**
	* 16-bit field
	* Used to verify the integrity of the UDP header

---

## Internet Layer Protocols

After a transport protocol has been selected, which is based on whether the communication should be connection oriented or connectionless, the information is passed to the Internet layer to determine who is responsible for its delivery.
A few protocols run at the Internet layer, such as IP, ICMP, and ARP.

### Internet Protocol

The Internet Protocol (IP) provides packet delivery for protocols in higher layers of the model.
It is connectionless delivery system that makes a "best-effort" attempt to deliver of the packets.
IP simply sends the data.

The Internet Protocol is also responsible for the logical addressing and routing of TCP/IP and, therefore, is considered a layer 3 protocol of the OSI model.
The IP on the router is responsible for decrementing the TTL (time to live) of the packet to prevent it from running in a "network loop."
Once the TTL of the packet is decremented to 0, the router removes the pakcet from the network and sends a status message to the sender (using ICMP); this prevents loops.

#### IP Header

![[Pasted image 20251005121323.png]]

* **Version**
	* 4-bit
	* identifies the version of IP being used (IPv4, IPv6)
* **Header length**
	* 4-bit
	* size of the IP header
* **Type of Service**
	* 8-bit
	* how the packet should be handled by the system
	* For example, if the low delay option is specified here, it means that the system should deal with the packet right away.
* **Total length**
	* 16-bit
	* size of the IP packet
* **Identification**
	* 16-bit
	* Because networks can handle only packets of a specific maximum size (known as a *maximum transmission unit, MTU*), the system may break the data being sent into multiple fragments.
	* Uniquely identifies the fragment
* **IP Flags**
	* 3-bit
	* how fragments are going the be dealt with
	* For example, a More Fragment (MF) flag indicates more fragments are to come.
	* Also a bit known as Don't Fragment (DF) specifies not to fragment the packet.
* **Fragment Offset**
	* 13-bit
	* Specifies the order in which the fragments are to be put back together when the packet is assembled.
* **Time to Live (TTL)**
	* 8-bit
	* When the packet is to expire.
	* TTL is a value that is decremented with every router the packet passes through. When the TTL reaches 0, the packet is discarded.
* **Protocol**
	* 8-bit
	* Specifies what layer 4 protocol (TCP or UDP) the packet should use.
* **Header Checksum**
	* 16-bit
	* verifies the integrity of the IP header
* **Source Address**
	* 32-bit
	* IP address of the sending system.
	* This is how the receiving system knows where to send the reply message
* **Destination Address**
	* 32-bit
	* IP address of the system the packet is destined for
* **IP Options**
	* Variable length
	* Used to specify any other settings in the IP header.

### Internet Control Message Protocol

The ICMP enables systems on a TCP/IP network to share status and error information.
You can use the status information to detect trouble.

ICMP messages are encapsulated within IP datagrams so taht they can be routed throughout a network.
Two programs that use ICMP messages are ping and tracert.

You can use ping to send ICMP echo requests to an IP address and wait for ICMP echo responses.
Ping reports the time interval between sending the request and receiving the response.
With ping, you can determine whether a particular IP system on your network is functioning correctly.

Tracert traces the path taken a particular host.
This utility can be useful in troubleshooting internetworks.
Tracert sends ICMP echo requests to an IP address while it increments the TTL field in the IP header by a count of 1, after starting at 1, and then analyzing the ICMP errors that are returned.
Each succeeding echo request should get one unit further into the network before the TTL field reaches 0 and an "ICMP time exceeded" error message is returned by the router attempting to forward it.

#### ICMP Types and Codes

ICMP does not use port numbers, but instead uses ICMP types and codes to identify the different types of messages.
For example, an echo request message that is used by the ping request uses ICMP type 8, while the ping reply comes back with an ICMP type 0 message.

Some of the ICMP types are broken down to finer levels with different codes in the type.
For example, ICMP type 3 is "destination unreachable" message, but because there are many reasons why a destination is unreachable, the type subdivided into different codes.
Each code represents a different message in the type

| type               | code | desc                             |
| ------------------ | ---- | -------------------------------- |
| 0 Echo Reply       | 0    | Echo reply                       |
| 3 Dest Unreachable | 0    | Destination network              |
|                    | 1    | Destination host unreachable     |
|                    | 2    | Destination protocol unreachable |
|                    | 3    | Destination port unreachable     |
| 8 Echo request     | 0    | Echo request                     |

#### ICMP Header

The ICMP header is a very small header compared to the IP header and the TCP header.

![[Pasted image 20251005124646.png]]

* **Type**
	* 8-bit
	* Indicates the ICMP type being used
* **Code**
	* 8-bit
	* Indicates the ICMP code being used
* **Checksum**
	* 16-bit
	* Used to verify the integrity of the ICMP header
* **Other**
	* Stores any data within the ICMP header.
	* For example, MS operating systems place part of the alphabet in this field for echo request messages

Also note that Internet Group Management Protocol (IGMP) is another internet-layer protocol and is used for multicast applications.

### Address Resolution Protocol

ARP provides IP address to physical address resolution on a TCP/IP network.
To accomplish this feature, ARP sends out a broadcast message with an ARP request packet that contains the IP address of the system it is trying to find.
All systems on the local network see the message, and the system that owns the IP address for which ARP is looking replies by sending its physical address to the originating system in the ARP reply packet.
The physical/IP address combo is then stored in the ARP cache of the originating system for future use.

All systems maintain ARP caches that include IP address-to-physical address mappings.
The ARP cache is always checked for an IP address-to-physical address mapping before initiating a broadcast.

#### Single-Segment ARP Example

![[Pasted image 20251005125454.png]]

In this example, PC-A wants to send information direclty to PC-B.
PC-A knows PC-B's IP address (or has DNS resolve it to an IP address); however, it doesn't know PC-B's Etherenet MAC address.

To resolve, or convert, the IP address to a MAC address, PC-A generates an ARP request message.

In the ARP request message, the source IP address is 10.1.1.1 and the destination IP address is 255.255.255.255 (the broadcast address).
PC-A includes PC-B's IP address in the data field of the ARP datagram. This is encapsulated into an Ethernet frame, with a source MAC address of 0000.0CCC.1111 (PC-A's MAC address), and a destination MAC address of FF:FF:FF:FF:FF:FF (local broadcast address) and is then placed on the Ethernet segment.

Both devices' network interface cards (NICs) notice the data link layer broadcast address and assuem that this frame is for them, since the destination MAC address is a broadcast, so they strip off he Ethernet frame and pass the IP datagram with the ARP request up to the Internet layer.
Again, there is a broadcast address in the destination IP address field, so both devices' TCP/IP stacks will examine the data payload.
PC-B notices that this is an ARP request and that this is its own IP address in the query, and it therefore responds directly back to PC-A with PC-B's MAC address.
PC-C, however, sees that this is not an ARP for its own MAC address and ignores the requested datagram broadcast.

#### Two-Segment ARP Example

![[Pasted image 20251005134649.png]]

In this example, PC-A wants to connect to PC-B using IP.
The source IP address is 1.1.1.1 (PC-A), and the destination is 2.2.2.2 (PC-B).
Because the two devices are on different networks, a router is used to communicate between the networks. Therefore, if PC-A wants to send something to PC-B it has to be sent via the intermediate router.
However, this communication does not occur at the network layer using IP; instead, it occurs at the data link layer.

The first thing that PC-A will do is determine whether the destination IP address is on the local network or a remote network. In this example, it is determined that the destination is on a remote network, so PC-A will need to know the MAC address of the default gateway router in order to send the data to the router.
If the router's MAC address isn't already in its local ARP cache, PC-A will generate an ARP request for the default gateway's MAC address.
In step 2, the router responds with the MAC address of its Ethernet interface connected to PC-A.
In step 3, PC-A creats an IP packet with the source and destination IP address (the source is 1.1.1.1 and the destination is 2.2.2.2, PC-B) and encapsulates this in an Ethernet frame, with the source MAC address of PC-A and the destination MAC address of the *router*.
PC-A then sends the Ethernet frame to the router.

When the router receives the Ethernet frame, the router compares the frame to the MAC address on its Ethernet interface, which it matches. The router strips off the Ethernet frame and makes a routing decision based on the destination address of 2.2.2.2.
In this case, the network is directly connected to the router's second interface.

In step 4, if the router doesn't have PC-B's MAC address in its local ARP cache, the router ARPs for the MAC address of PC-B (2.2.2.2) and receives the response in step 5.
The router then encapsulates the original IP packet in a new Ethernet frame in step 6, placing its second interface's MAC address, which is sourcing the frame, in the source MAC address field and PC-B's MAC address in the destination field.
When PC-B receives this, it knows the frame is for itself (matching destination MAC address) and that PC-A originated the IP packet that's encapsulated based on the source IP address in the IP header at layer 3.

Note that in this example, the original IP addressing in the packet was not altered by the router, but two Ethernet frames are used to get the IP packet to the destination.
Also each device will keep the MAC addresses in a local ARP cache, so the next time PC-A needs to send someting to PC-B, the devices will not have to ARP other intermediate devices again.

### Exercise 3-1: Identifying TCP/IP Protocols

Matching the protocol to the correct description

![[Pasted image 20251005141411.png]]

ARP: Converts the local address to the physical address
IP: Responsible for logical addressing and routing
TCP: Responsible for reliable delivery
FTP: Application layer protoco used to download files
ICMP: Responsible for error and status reporting
SMTP: Internet Protocol to send e-mail
HTTPS: Secure transmission of web traffic
UDP: Unreliable delivery

---

## Chapter Review

TCP/IP is a suite of protocols, the most popular of which are TCP, UDP, IP, and ARP.

Application layer protocols are responsible for initiating a network request or servicing the network request.
HTTP, FTP, DNS, SMTP, and RDP

Transport layer protocols handle either connection-oriented communication (TCP) or connectionless communication (UDP).

Internet layer protocols handle logical addressing and routing functions. IP performs logical addressing, ARP converts the logical address to a physical address, and ICMP is the status- and error- reporting protocol.

---

## Quick Review

### TCP/IP Protocol Suite

* TCP/IP is suite of protocols. Each protocol in the suite has its own set of reponsibilities.
* TCP is used for connection-oriented, or reliable, communication. TCP uses sequence numbers and acknowledgement numbers to guraantee delivery.
* UDP is used for connectionless, or unreliable, communication and does not guarantee delivery.
* The Internet Protocol (IP) handles logical addressing and routing. it is responsible for packet routing and delivery.
* ARP, Address Resoultion Protocol, is used to convert logical addresses to physical addresses.
* ICMP is the error-reporting or status-reporting protocol in the TCP/IP protocol suite.

---

## Questions

1.  Which layer of the OSI model does IP run at?

A. Layer 2
**B. Layer 3**
C. Layer 4
D. Layer 5

![[Pasted image 20251005143751.png]]

IP runs at Internet layer. (network layer in OSI layer, layer 3)

2.  Which of the following protocols are layer 4 protocols of the OSI model? (Select all that apply.)

**A. TCP**
B. IP
C. ARP
**D. UDP**

OSI layer 4 is transport layer


3.  Which protocol is responsible for converting the IP address to a MAC address?

A. IP
B. TCP
**C. ARP**
D. ICMP

4.  Which protocol is responsible for connection-oriented communication?

**A. TCP**
B. IP
C. UDP
D. ICMP

5.  Which protocol is responsible for error reporting and status information?

**A. ICMP**
B. TCP
C. UDP
D. IP

6.  Which protocol is responsible for logical addressing and delivery of packets?

A. ICMP
B. TCP
**C. IP**
D. UDP

7.  What two items are used by TCP to guarantee delivery of data? (Choose two.)

A. Source port
**B. Acknowledgment numbers**
C. IP address
D. Destination port
**E. Sequence numbers**

8.  What field in the IP header identifies the system that the packet came from?

**A. Source IP address**
B. Protocol
C. Destination IP address
D. Source port

9.  What field in the TCP header is used to specify the target application that the packet is for?

A. Source port
B. Destination IP address
C. Source IP address
**D. Destination port**

## Performance-based Questions

1.  Using the following exhibit, write the protocols found on the left into
the appropriate box on the right to identify the layer that the
protocol runs at. On the real exam you would be expected to drag
and drop the items into the appropriate box.

![[Pasted image 20251005143351.png]]

**Application Layer**
HTTP, SMTP, FTP

**Transport Layer**
TCP, UDP

**Internet Layer**
ARP, ICMP, IP

**Network Access Layer**
Ethernet

2.  Looking at the following exhibit, identify the phases of the TCP three-way handshake by writing the phase name into the boxes. On the real exam you would drag the phase found on the left to the appropriate box on the right.

![[Pasted image 20251005143414.png]]

SYN
SYN/ACK
ACK
